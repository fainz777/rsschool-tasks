!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);i(1);class s{static getColor(t){if("string"==typeof t)return`#${t}`;let e=[...t];try{e[3]=4===e.length?(e[3]/255).toFixed(2):1,e=`rgba(${e.join(",")})`}catch(t){return"#000"}return e}static showMessage(t){alert(t)}}class o{constructor(t){t?(this.canvas=document.getElementById(t),this.canvas?(this.width=this.canvas.width,this.height=this.canvas.height,this.ctx=this.canvas.getContext("2d"),this.pixels=4,this.currenColorField=document.getElementById("current_color"),this.currentColorIcon=document.querySelector(".icon_color--current-color"),this.prevColorIcon=document.querySelector(".icon_color--prev_color"),this.currentColor=window.getComputedStyle(this.currentColorIcon).backgroundColor,this.currentTool=null,this.isPencilDrawStart=!1,this.pencilX=0,this.pencilY=0,this.toolsActions={paintBucket:"fillArea",pencil:"drawByPencil",colorPicker:"chooseColor"},this.keyBindingsCodes=["KeyB","KeyP","KeyC"],this.keyBindingsTools={KeyB:"paintBucket",KeyC:"colorPicker",KeyP:"pencil"},this.eventsTypes={mousedown:"mousedown",mouseup:"mouseup",mousemove:"mousemove"}):s.showMessage(`Error: canvas element with id ${t} was not found.`)):s.showMessage("Error: canvasId is not set.")}get pixelSize(){return this.width/this.pixels}setEvents(){this.canvasTools=document.querySelectorAll("[data-action]"),this.colorChangeElems=document.querySelectorAll(".item--color_change");const t=document.querySelectorAll(".canvas_change");document.addEventListener("keyup",this.manageKeyBindings.bind(this)),this.canvasTools.forEach(t=>{const{action:e}=t.dataset;t.addEventListener("click",this[e].bind(this,t))}),this.canvas.addEventListener("mousedown",this.manageCanvasActions.bind(this)),this.canvas.addEventListener("mouseup",this.manageCanvasActions.bind(this)),this.canvas.addEventListener("mousemove",this.manageCanvasActions.bind(this)),this.currenColorField.addEventListener("change",this.changeCurrentColor.bind(this)),this.colorChangeElems.forEach(t=>{t.addEventListener("click",this.setCurrentColor.bind(this,t))}),t.forEach(t=>{t.classList.contains("active")&&this.changeCanvasSize.bind(t),t.addEventListener("click",this.changeCanvasSize.bind(this,t))})}removeToolsActiveClass(){this.canvasTools.forEach(t=>{t.classList.remove("active")})}clearCanvas(){this.resetTools(),this.ctx.clearRect(0,0,this.width,this.height)}manageCanvasActions(t){const e=this.toolsActions[this.currentTool];e&&this[e](t)}resetTools(){this.removeToolsActiveClass(),this.canvas.classList.remove(this.currentTool),this.currentTool=null,this.isPencilDrawStart=!1,this.pencilX=0,this.pencilY=0}setTool(t){this.removeToolsActiveClass(),t.classList.add("active");const{tool:e}=t.dataset;this.canvas.classList.remove(this.currentTool),this.currentTool=e,this.canvas.classList.add(this.currentTool)}manageKeyBindings(t){this.keyBindingsCodes.includes(t.code)&&document.querySelector(`[data-tool="${this.keyBindingsTools[t.code]}"]`).click()}fillArea(t){t.type===this.eventsTypes.mousedown&&(this.ctx.fillStyle=this.currentColor,this.ctx.fillRect(0,0,this.width,this.height))}chooseColor(t){if(t.type===this.eventsTypes.mousedown){const e=this.getPointedColor(t.clientX,t.clientY);this.setPrevColor(this.currentColor),this.currentColor=e,this.currenColorField.value=e,this.setCurrentIconColor(this.currenColorField,e)}}drawByPencil(t){const e=this.getPointerPosition(t.clientX,t.clientY);t.type===this.eventsTypes.mousedown?(this.isPencilDrawStart=!0,this.drawPixel(e),this.pencilX=e.x,this.pencilY=e.y):t.type===this.eventsTypes.mousemove&&this.isPencilDrawStart?this.drawLine(this.pencilX,this.pencilY,e.x,e.y):t.type===this.eventsTypes.mouseup&&(this.isPencilDrawStart=!1)}drawLine(t,e,i,s){Math.abs(s-e)<Math.abs(i-t)?t>i?this.drawLineLow(i,s,t,e):this.drawLineLow(t,e,i,s):e>s?this.drawLineHigh(i,s,t,e):this.drawLineHigh(t,e,i,s),this.pencilX=i,this.pencilY=s}drawLineLow(t,e,i,s){const o=i-t;let n=s-e,r=1;n<0&&(r=-1,n=-n);let c=2*n-o,l=e;for(let e=t;e<=i;e+=1)this.drawPixel({x:e,y:l}),c>0&&(l+=r,c-=2*o),c+=2*n}drawLineHigh(t,e,i,s){let o=i-t;const n=s-e;let r=1;o<0&&(r=-1,o=-o);let c=2*o-n,l=t;for(let t=e;t<=s;t+=1)this.drawPixel({x:l,y:t}),c>0&&(l+=r,c-=2*n),c+=2*o}drawPixel(t){this.ctx.fillStyle=this.currentColor,this.ctx.fillRect(t.x*this.pixelSize,t.y*this.pixelSize,this.pixelSize,this.pixelSize)}getPointerPosition(t,e){const i=this.canvas.getBoundingClientRect();return{x:Math.floor((t-i.left)/this.pixelSize),y:Math.floor((e-i.top)/this.pixelSize)}}getPointedColor(t,e){const i=this.canvas.getBoundingClientRect(),o=t-i.left,n=e-i.top;let r=this.ctx.getImageData(o,n,1,1).data;return r=s.getColor(r)}changeCurrentColor(t){const e=t.target,i=e.value;this.setPrevColor(this.currentColor),this.currentColor=i,this.setCurrentIconColor(e,i)}setCurrentIconColor(t,e){t.closest(".tools_group__item").querySelector(".icon_color").style.backgroundColor=e}setPrevColor(t){this.prevColor=t,this.prevColorIcon.style.backgroundColor=t}setCurrentColor(t){const e=t.querySelector(".icon_color"),i=window.getComputedStyle(e).backgroundColor;this.currentColor=i,this.currenColorField.value=i,this.currentColorIcon.style.backgroundColor=i}changeCanvasSize(t){const e=t.classList;e.contains("active")||(document.querySelector(".canvas_change.active").classList.remove("active"),e.add("active"),this.pixels=t.dataset.pixels,this.clearCanvas())}init(){this.setEvents()}}document.addEventListener("DOMContentLoaded",(function(){new o("palette").init()}))},function(t,e){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2NhbnZhcy5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvanMvaW5kZXguanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJIZWxwZXJzIiwiY29sb3IiLCJyZ2JhQ29sb3IiLCJsZW5ndGgiLCJ0b0ZpeGVkIiwiam9pbiIsImUiLCJtZXNzYWdlIiwiYWxlcnQiLCJjYW52YXNJZCIsInRoaXMiLCJjYW52YXMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwid2lkdGgiLCJoZWlnaHQiLCJjdHgiLCJnZXRDb250ZXh0IiwicGl4ZWxzIiwiY3VycmVuQ29sb3JGaWVsZCIsImN1cnJlbnRDb2xvckljb24iLCJxdWVyeVNlbGVjdG9yIiwicHJldkNvbG9ySWNvbiIsImN1cnJlbnRDb2xvciIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJjdXJyZW50VG9vbCIsImlzUGVuY2lsRHJhd1N0YXJ0IiwicGVuY2lsWCIsInBlbmNpbFkiLCJ0b29sc0FjdGlvbnMiLCJwYWludEJ1Y2tldCIsInBlbmNpbCIsImNvbG9yUGlja2VyIiwia2V5QmluZGluZ3NDb2RlcyIsImtleUJpbmRpbmdzVG9vbHMiLCJLZXlCIiwiS2V5QyIsIktleVAiLCJldmVudHNUeXBlcyIsIm1vdXNlZG93biIsIm1vdXNldXAiLCJtb3VzZW1vdmUiLCJzaG93TWVzc2FnZSIsImNhbnZhc1Rvb2xzIiwicXVlcnlTZWxlY3RvckFsbCIsImNvbG9yQ2hhbmdlRWxlbXMiLCJjYW52YXNDaGFuZ2VFbGVtcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJtYW5hZ2VLZXlCaW5kaW5ncyIsImZvckVhY2giLCJ0b29sSXRlbSIsImFjdGlvbiIsImRhdGFzZXQiLCJtYW5hZ2VDYW52YXNBY3Rpb25zIiwiY2hhbmdlQ3VycmVudENvbG9yIiwiZWxlbSIsInNldEN1cnJlbnRDb2xvciIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiY2hhbmdlQ2FudmFzU2l6ZSIsInJlbW92ZSIsInJlc2V0VG9vbHMiLCJjbGVhclJlY3QiLCJyZW1vdmVUb29sc0FjdGl2ZUNsYXNzIiwiYWRkIiwidG9vbCIsImluY2x1ZGVzIiwiY29kZSIsImNsaWNrIiwidHlwZSIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwiZ2V0UG9pbnRlZENvbG9yIiwiY2xpZW50WCIsImNsaWVudFkiLCJzZXRQcmV2Q29sb3IiLCJzZXRDdXJyZW50SWNvbkNvbG9yIiwiY29vcmRpbmF0ZXMiLCJnZXRQb2ludGVyUG9zaXRpb24iLCJkcmF3UGl4ZWwiLCJ4IiwieSIsImRyYXdMaW5lIiwieDAiLCJ5MCIsIngxIiwieTEiLCJNYXRoIiwiYWJzIiwiZHJhd0xpbmVMb3ciLCJkcmF3TGluZUhpZ2giLCJkZWx0YVgiLCJkZWx0YVkiLCJkaXIiLCJkaWZmIiwicGl4ZWxTaXplIiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImZsb29yIiwibGVmdCIsInRvcCIsImdldEltYWdlRGF0YSIsImRhdGEiLCJnZXRDb2xvciIsImZpZWxkIiwidGFyZ2V0IiwiY2xvc2VzdCIsInN0eWxlIiwicHJldkNvbG9yIiwiaWNvbiIsImVsZW1DbGFz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VUFFaEJ4RCxLQUFLUSxPQUFTdUMsRUFBS0gsUUFBUXBDLE9BQzNCUixLQUFLdUcsZUFHUCxPQUNFdkcsS0FBS3dHLGFDelNUdEcsU0FBU3FDLGlCQUFpQixvQkFMMUIsV0FDa0IsSUFBSSxFQUFPLFdBQ25Ca0UsVyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgSGVscGVycyB7XG4gIHN0YXRpYyBnZXRDb2xvcihjb2xvcikge1xuICAgIGNvbnN0IGRlZmF1bHRDb2xvciA9ICcjMDAwJztcblxuICAgIGlmICh0eXBlb2YgY29sb3IgPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gYCMke2NvbG9yfWA7XG4gICAgfVxuXG4gICAgbGV0IHJnYmFDb2xvciA9IFsuLi5jb2xvcl07XG5cbiAgICB0cnkge1xuICAgICAgcmdiYUNvbG9yWzNdID0gcmdiYUNvbG9yLmxlbmd0aCA9PT0gNCA/IChyZ2JhQ29sb3JbM10gLyAyNTUpLnRvRml4ZWQoMikgOiAxO1xuICAgICAgcmdiYUNvbG9yID0gYHJnYmEoJHtyZ2JhQ29sb3Iuam9pbignLCcpfSlgO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0Q29sb3I7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJnYmFDb2xvcjtcbiAgfVxuXG4gIHN0YXRpYyBzaG93TWVzc2FnZShtZXNzYWdlKSB7XG4gICAgYWxlcnQobWVzc2FnZSk7XG4gIH1cbn1cbiIsImltcG9ydCBIZWxwZXJzIGZyb20gJy4vaGVscGVycyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhbnZhcyB7XG4gIGNvbnN0cnVjdG9yKGNhbnZhc0lkKSB7XG4gICAgaWYgKCFjYW52YXNJZCkge1xuICAgICAgSGVscGVycy5zaG93TWVzc2FnZSgnRXJyb3I6IGNhbnZhc0lkIGlzIG5vdCBzZXQuJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXNJZCk7XG5cbiAgICBpZiAoIXRoaXMuY2FudmFzKSB7XG4gICAgICBIZWxwZXJzLnNob3dNZXNzYWdlKGBFcnJvcjogY2FudmFzIGVsZW1lbnQgd2l0aCBpZCAke2NhbnZhc0lkfSB3YXMgbm90IGZvdW5kLmApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMud2lkdGggPSB0aGlzLmNhbnZhcy53aWR0aDtcbiAgICB0aGlzLmhlaWdodCA9IHRoaXMuY2FudmFzLmhlaWdodDtcbiAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgdGhpcy5waXhlbHMgPSA0O1xuXG4gICAgdGhpcy5jdXJyZW5Db2xvckZpZWxkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1cnJlbnRfY29sb3InKTtcbiAgICB0aGlzLmN1cnJlbnRDb2xvckljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaWNvbl9jb2xvci0tY3VycmVudC1jb2xvcicpO1xuICAgIHRoaXMucHJldkNvbG9ySWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pY29uX2NvbG9yLS1wcmV2X2NvbG9yJyk7XG4gICAgdGhpcy5jdXJyZW50Q29sb3IgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmN1cnJlbnRDb2xvckljb24pLmJhY2tncm91bmRDb2xvcjtcblxuICAgIHRoaXMuY3VycmVudFRvb2wgPSBudWxsO1xuICAgIHRoaXMuaXNQZW5jaWxEcmF3U3RhcnQgPSBmYWxzZTtcbiAgICB0aGlzLnBlbmNpbFggPSAwO1xuICAgIHRoaXMucGVuY2lsWSA9IDA7XG5cbiAgICB0aGlzLnRvb2xzQWN0aW9ucyA9IHtcbiAgICAgIHBhaW50QnVja2V0OiAnZmlsbEFyZWEnLFxuICAgICAgcGVuY2lsOiAnZHJhd0J5UGVuY2lsJyxcbiAgICAgIGNvbG9yUGlja2VyOiAnY2hvb3NlQ29sb3InLFxuICAgIH07XG5cbiAgICB0aGlzLmtleUJpbmRpbmdzQ29kZXMgPSBbJ0tleUInLCAnS2V5UCcsICdLZXlDJ107XG5cbiAgICB0aGlzLmtleUJpbmRpbmdzVG9vbHMgPSB7XG4gICAgICBLZXlCOiAncGFpbnRCdWNrZXQnLFxuICAgICAgS2V5QzogJ2NvbG9yUGlja2VyJyxcbiAgICAgIEtleVA6ICdwZW5jaWwnLFxuICAgIH07XG5cbiAgICB0aGlzLmV2ZW50c1R5cGVzID0ge1xuICAgICAgbW91c2Vkb3duOiAnbW91c2Vkb3duJyxcbiAgICAgIG1vdXNldXA6ICdtb3VzZXVwJyxcbiAgICAgIG1vdXNlbW92ZTogJ21vdXNlbW92ZScsXG4gICAgfTtcbiAgfVxuXG4gIGdldCBwaXhlbFNpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMud2lkdGggLyB0aGlzLnBpeGVscztcbiAgfVxuXG4gIHNldEV2ZW50cygpIHtcbiAgICB0aGlzLmNhbnZhc1Rvb2xzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtYWN0aW9uXScpO1xuICAgIHRoaXMuY29sb3JDaGFuZ2VFbGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pdGVtLS1jb2xvcl9jaGFuZ2UnKTtcbiAgICBjb25zdCBjYW52YXNDaGFuZ2VFbGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jYW52YXNfY2hhbmdlJyk7XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMubWFuYWdlS2V5QmluZGluZ3MuYmluZCh0aGlzKSk7XG5cbiAgICB0aGlzLmNhbnZhc1Rvb2xzLmZvckVhY2goKHRvb2xJdGVtKSA9PiB7XG4gICAgICBjb25zdCB7IGFjdGlvbiB9ID0gdG9vbEl0ZW0uZGF0YXNldDtcbiAgICAgIHRvb2xJdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpc1thY3Rpb25dLmJpbmQodGhpcywgdG9vbEl0ZW0pKTtcbiAgICB9KTtcblxuICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMubWFuYWdlQ2FudmFzQWN0aW9ucy5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5tYW5hZ2VDYW52YXNBY3Rpb25zLmJpbmQodGhpcykpO1xuICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMubWFuYWdlQ2FudmFzQWN0aW9ucy5iaW5kKHRoaXMpKTtcblxuICAgIHRoaXMuY3VycmVuQ29sb3JGaWVsZC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB0aGlzLmNoYW5nZUN1cnJlbnRDb2xvci5iaW5kKHRoaXMpKTtcblxuICAgIHRoaXMuY29sb3JDaGFuZ2VFbGVtcy5mb3JFYWNoKChlbGVtKSA9PiB7XG4gICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5zZXRDdXJyZW50Q29sb3IuYmluZCh0aGlzLCBlbGVtKSk7XG4gICAgfSk7XG5cbiAgICBjYW52YXNDaGFuZ2VFbGVtcy5mb3JFYWNoKChlbGVtKSA9PiB7XG4gICAgICBjb25zdCBlbGVtQ2xhc3NlcyA9IGVsZW0uY2xhc3NMaXN0O1xuXG4gICAgICBpZiAoZWxlbUNsYXNzZXMuY29udGFpbnMoJ2FjdGl2ZScpKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlQ2FudmFzU2l6ZS5iaW5kKGVsZW0pO1xuICAgICAgfVxuXG4gICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jaGFuZ2VDYW52YXNTaXplLmJpbmQodGhpcywgZWxlbSkpO1xuICAgIH0pO1xuICB9XG5cbiAgcmVtb3ZlVG9vbHNBY3RpdmVDbGFzcygpIHtcbiAgICB0aGlzLmNhbnZhc1Rvb2xzLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgfSk7XG4gIH1cblxuICBjbGVhckNhbnZhcygpIHtcbiAgICB0aGlzLnJlc2V0VG9vbHMoKTtcbiAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICB9XG5cbiAgbWFuYWdlQ2FudmFzQWN0aW9ucyhlKSB7XG4gICAgY29uc3QgYWN0aW9uID0gdGhpcy50b29sc0FjdGlvbnNbdGhpcy5jdXJyZW50VG9vbF07XG5cbiAgICBpZiAoYWN0aW9uKSB7XG4gICAgICB0aGlzW2FjdGlvbl0oZSk7XG4gICAgfVxuICB9XG5cbiAgcmVzZXRUb29scygpIHtcbiAgICB0aGlzLnJlbW92ZVRvb2xzQWN0aXZlQ2xhc3MoKTtcbiAgICB0aGlzLmNhbnZhcy5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY3VycmVudFRvb2wpO1xuICAgIHRoaXMuY3VycmVudFRvb2wgPSBudWxsO1xuICAgIHRoaXMuaXNQZW5jaWxEcmF3U3RhcnQgPSBmYWxzZTtcbiAgICB0aGlzLnBlbmNpbFggPSAwO1xuICAgIHRoaXMucGVuY2lsWSA9IDA7XG4gIH1cblxuICBzZXRUb29sKHRvb2xJdGVtKSB7XG4gICAgdGhpcy5yZW1vdmVUb29sc0FjdGl2ZUNsYXNzKCk7XG4gICAgdG9vbEl0ZW0uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG5cbiAgICBjb25zdCB7IHRvb2wgfSA9IHRvb2xJdGVtLmRhdGFzZXQ7XG4gICAgdGhpcy5jYW52YXMuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmN1cnJlbnRUb29sKTtcbiAgICB0aGlzLmN1cnJlbnRUb29sID0gdG9vbDtcbiAgICB0aGlzLmNhbnZhcy5jbGFzc0xpc3QuYWRkKHRoaXMuY3VycmVudFRvb2wpO1xuICB9XG5cbiAgbWFuYWdlS2V5QmluZGluZ3MoZSkge1xuICAgIGlmICh0aGlzLmtleUJpbmRpbmdzQ29kZXMuaW5jbHVkZXMoZS5jb2RlKSkge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtdG9vbD1cIiR7dGhpcy5rZXlCaW5kaW5nc1Rvb2xzW2UuY29kZV19XCJdYCkuY2xpY2soKTtcbiAgICB9XG4gIH1cblxuICBmaWxsQXJlYShlKSB7XG4gICAgaWYgKGUudHlwZSA9PT0gdGhpcy5ldmVudHNUeXBlcy5tb3VzZWRvd24pIHtcbiAgICAgIC8qIGNvbnN0IGNvb3JkaW5hdGVzID0gdGhpcy5nZXRQb2ludGVyUG9zaXRpb24oZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuXG4gICAgICBjb25zdCBjb2xvciA9IHRoaXMuZ2V0UG9pbnRlZENvbG9yKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcblxuICAgICAgaWYgKGNvbG9yID09PSB0aGlzLmN1cnJlbnRDb2xvcikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9ICovXG4gICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSB0aGlzLmN1cnJlbnRDb2xvcjtcbiAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICB9XG4gIH1cblxuICBjaG9vc2VDb2xvcihlKSB7XG4gICAgaWYgKGUudHlwZSA9PT0gdGhpcy5ldmVudHNUeXBlcy5tb3VzZWRvd24pIHtcbiAgICAgIGNvbnN0IGNvbG9yID0gdGhpcy5nZXRQb2ludGVkQ29sb3IoZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgICAgdGhpcy5zZXRQcmV2Q29sb3IodGhpcy5jdXJyZW50Q29sb3IpO1xuICAgICAgdGhpcy5jdXJyZW50Q29sb3IgPSBjb2xvcjtcbiAgICAgIHRoaXMuY3VycmVuQ29sb3JGaWVsZC52YWx1ZSA9IGNvbG9yO1xuICAgICAgdGhpcy5zZXRDdXJyZW50SWNvbkNvbG9yKHRoaXMuY3VycmVuQ29sb3JGaWVsZCwgY29sb3IpO1xuICAgIH1cbiAgfVxuXG4gIGRyYXdCeVBlbmNpbChlKSB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSB0aGlzLmdldFBvaW50ZXJQb3NpdGlvbihlLmNsaWVudFgsIGUuY2xpZW50WSk7XG5cbiAgICBpZiAoZS50eXBlID09PSB0aGlzLmV2ZW50c1R5cGVzLm1vdXNlZG93bikge1xuICAgICAgdGhpcy5pc1BlbmNpbERyYXdTdGFydCA9IHRydWU7XG4gICAgICB0aGlzLmRyYXdQaXhlbChjb29yZGluYXRlcyk7XG4gICAgICB0aGlzLnBlbmNpbFggPSBjb29yZGluYXRlcy54O1xuICAgICAgdGhpcy5wZW5jaWxZID0gY29vcmRpbmF0ZXMueTtcbiAgICB9IGVsc2UgaWYgKGUudHlwZSA9PT0gdGhpcy5ldmVudHNUeXBlcy5tb3VzZW1vdmUgJiYgdGhpcy5pc1BlbmNpbERyYXdTdGFydCkge1xuICAgICAgdGhpcy5kcmF3TGluZSh0aGlzLnBlbmNpbFgsIHRoaXMucGVuY2lsWSwgY29vcmRpbmF0ZXMueCwgY29vcmRpbmF0ZXMueSk7XG4gICAgfSBlbHNlIGlmIChlLnR5cGUgPT09IHRoaXMuZXZlbnRzVHlwZXMubW91c2V1cCkge1xuICAgICAgdGhpcy5pc1BlbmNpbERyYXdTdGFydCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG5cbiAgZHJhd0xpbmUoeDAsIHkwLCB4MSwgeTEpIHtcbiAgICBpZiAoTWF0aC5hYnMoeTEgLSB5MCkgPCBNYXRoLmFicyh4MSAtIHgwKSkge1xuICAgICAgaWYgKHgwID4geDEpIHtcbiAgICAgICAgdGhpcy5kcmF3TGluZUxvdyh4MSwgeTEsIHgwLCB5MCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRyYXdMaW5lTG93KHgwLCB5MCwgeDEsIHkxKTtcbiAgICAgIH1cbiAgICB9IGVsc2VcbiAgICBpZiAoeTAgPiB5MSkge1xuICAgICAgdGhpcy5kcmF3TGluZUhpZ2goeDEsIHkxLCB4MCwgeTApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRyYXdMaW5lSGlnaCh4MCwgeTAsIHgxLCB5MSk7XG4gICAgfVxuXG4gICAgdGhpcy5wZW5jaWxYID0geDE7XG4gICAgdGhpcy5wZW5jaWxZID0geTE7XG4gIH1cblxuICBkcmF3TGluZUxvdyh4MCwgeTAsIHgxLCB5MSkge1xuICAgIGNvbnN0IGRlbHRhWCA9IHgxIC0geDA7XG4gICAgbGV0IGRlbHRhWSA9IHkxIC0geTA7XG4gICAgbGV0IGRpciA9IDE7XG4gICAgaWYgKGRlbHRhWSA8IDApIHtcbiAgICAgIGRpciA9IC0xO1xuICAgICAgZGVsdGFZID0gLWRlbHRhWTtcbiAgICB9XG5cbiAgICBsZXQgZGlmZiA9IDIgKiBkZWx0YVkgLSBkZWx0YVg7XG4gICAgbGV0IHkgPSB5MDtcblxuICAgIGZvciAobGV0IHggPSB4MDsgeCA8PSB4MTsgeCArPSAxKSB7XG4gICAgICB0aGlzLmRyYXdQaXhlbCh7IHgsIHkgfSk7XG4gICAgICBpZiAoZGlmZiA+IDApIHtcbiAgICAgICAgeSArPSBkaXI7XG4gICAgICAgIGRpZmYgLT0gMiAqIGRlbHRhWDtcbiAgICAgIH1cblxuICAgICAgZGlmZiArPSAyICogZGVsdGFZO1xuICAgIH1cbiAgfVxuXG4gIGRyYXdMaW5lSGlnaCh4MCwgeTAsIHgxLCB5MSkge1xuICAgIGxldCBkZWx0YVggPSB4MSAtIHgwO1xuICAgIGNvbnN0IGRlbHRhWSA9IHkxIC0geTA7XG5cbiAgICBsZXQgZGlyID0gMTtcbiAgICBpZiAoZGVsdGFYIDwgMCkge1xuICAgICAgZGlyID0gLTE7XG4gICAgICBkZWx0YVggPSAtZGVsdGFYO1xuICAgIH1cblxuICAgIGxldCBkaWZmID0gMiAqIGRlbHRhWCAtIGRlbHRhWTtcbiAgICBsZXQgeCA9IHgwO1xuXG4gICAgZm9yIChsZXQgeSA9IHkwOyB5IDw9IHkxOyB5ICs9IDEpIHtcbiAgICAgIHRoaXMuZHJhd1BpeGVsKHsgeCwgeSB9KTtcbiAgICAgIGlmIChkaWZmID4gMCkge1xuICAgICAgICB4ICs9IGRpcjtcbiAgICAgICAgZGlmZiAtPSAyICogZGVsdGFZO1xuICAgICAgfVxuXG4gICAgICBkaWZmICs9IDIgKiBkZWx0YVg7XG4gICAgfVxuICB9XG5cbiAgZHJhd1BpeGVsKGNvb3JkaW5hdGVzKSB7XG4gICAgdGhpcy5jdHguZmlsbFN0eWxlID0gdGhpcy5jdXJyZW50Q29sb3I7XG4gICAgdGhpcy5jdHguZmlsbFJlY3QoXG4gICAgICBjb29yZGluYXRlcy54ICogdGhpcy5waXhlbFNpemUsXG4gICAgICBjb29yZGluYXRlcy55ICogdGhpcy5waXhlbFNpemUsXG4gICAgICB0aGlzLnBpeGVsU2l6ZSxcbiAgICAgIHRoaXMucGl4ZWxTaXplLFxuICAgICk7XG4gIH1cblxuICBnZXRQb2ludGVyUG9zaXRpb24oY2xpZW50WCwgY2xpZW50WSkge1xuICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCB4ID0gTWF0aC5mbG9vcigoY2xpZW50WCAtIHJlY3QubGVmdCkgLyB0aGlzLnBpeGVsU2l6ZSk7XG4gICAgY29uc3QgeSA9IE1hdGguZmxvb3IoKGNsaWVudFkgLSByZWN0LnRvcCkgLyB0aGlzLnBpeGVsU2l6ZSk7XG5cbiAgICByZXR1cm4geyB4LCB5IH07XG4gIH1cblxuICBnZXRQb2ludGVkQ29sb3IoY2xpZW50WCwgY2xpZW50WSkge1xuICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCB4ID0gY2xpZW50WCAtIHJlY3QubGVmdDtcbiAgICBjb25zdCB5ID0gY2xpZW50WSAtIHJlY3QudG9wO1xuICAgIGxldCBjb2xvciA9IHRoaXMuY3R4LmdldEltYWdlRGF0YSh4LCB5LCAxLCAxKS5kYXRhO1xuICAgIGNvbG9yID0gSGVscGVycy5nZXRDb2xvcihjb2xvcik7XG5cbiAgICByZXR1cm4gY29sb3I7XG4gIH1cblxuICBjaGFuZ2VDdXJyZW50Q29sb3IoZSkge1xuICAgIGNvbnN0IGZpZWxkID0gZS50YXJnZXQ7XG4gICAgY29uc3QgY29sb3IgPSBmaWVsZC52YWx1ZTtcbiAgICB0aGlzLnNldFByZXZDb2xvcih0aGlzLmN1cnJlbnRDb2xvcik7XG4gICAgdGhpcy5jdXJyZW50Q29sb3IgPSBjb2xvcjtcbiAgICB0aGlzLnNldEN1cnJlbnRJY29uQ29sb3IoZmllbGQsIGNvbG9yKTtcbiAgfVxuXG4gIHNldEN1cnJlbnRJY29uQ29sb3IoZmllbGQsIGNvbG9yKSB7XG4gICAgY29uc3QgaWNvbiA9IGZpZWxkLmNsb3Nlc3QoJy50b29sc19ncm91cF9faXRlbScpLnF1ZXJ5U2VsZWN0b3IoJy5pY29uX2NvbG9yJyk7XG4gICAgaWNvbi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjtcbiAgfVxuXG4gIHNldFByZXZDb2xvcihjb2xvcikge1xuICAgIHRoaXMucHJldkNvbG9yID0gY29sb3I7XG4gICAgdGhpcy5wcmV2Q29sb3JJY29uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuICB9XG5cbiAgc2V0Q3VycmVudENvbG9yKGVsZW0pIHtcbiAgICBjb25zdCBpY29uID0gZWxlbS5xdWVyeVNlbGVjdG9yKCcuaWNvbl9jb2xvcicpO1xuICAgIGNvbnN0IGNvbG9yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoaWNvbikuYmFja2dyb3VuZENvbG9yO1xuICAgIHRoaXMuY3VycmVudENvbG9yID0gY29sb3I7XG4gICAgdGhpcy5jdXJyZW5Db2xvckZpZWxkLnZhbHVlID0gY29sb3I7XG4gICAgdGhpcy5jdXJyZW50Q29sb3JJY29uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuICB9XG5cbiAgY2hhbmdlQ2FudmFzU2l6ZShlbGVtKSB7XG4gICAgY29uc3QgZWxlbUNsYXNzZXMgPSBlbGVtLmNsYXNzTGlzdDtcblxuICAgIGlmIChlbGVtQ2xhc3Nlcy5jb250YWlucygnYWN0aXZlJykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBhY3RpdmVFbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNhbnZhc19jaGFuZ2UuYWN0aXZlJyk7XG4gICAgYWN0aXZlRWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICBlbGVtQ2xhc3Nlcy5hZGQoJ2FjdGl2ZScpO1xuXG4gICAgdGhpcy5waXhlbHMgPSBlbGVtLmRhdGFzZXQucGl4ZWxzO1xuICAgIHRoaXMuY2xlYXJDYW52YXMoKTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgdGhpcy5zZXRFdmVudHMoKTtcbiAgfVxufVxuIiwiaW1wb3J0ICcuLi9zdHlsZXMvc3R5bGUuY3NzJztcblxuLy8gaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IENhbnZhcyBmcm9tICcuL2NhbnZhcyc7XG5cbmZ1bmN0aW9uIGluaXQoKSB7XG4gIGNvbnN0IHBhbGV0dGUgPSBuZXcgQ2FudmFzKCdwYWxldHRlJyk7XG4gIHBhbGV0dGUuaW5pdCgpO1xufVxuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgaW5pdCk7XG4iXSwic291cmNlUm9vdCI6IiJ9