!function(t){var e={};function i(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(o,s,function(e){return t[e]}.bind(null,s));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);i(1);class o{static getColor(t){if("string"==typeof t)return`#${t}`;let e=[...t];try{e[3]=4===e.length?(e[3]/255).toFixed(2):1,e=`rgba(${e.join(",")})`}catch(t){return"#000"}return e}static showMessage(t){alert(t)}}class s{constructor(t){t?(this.canvas=document.getElementById(t),this.canvas?(this.width=this.canvas.width,this.height=this.canvas.height,this.ctx=this.canvas.getContext("2d"),this.pixels=4,this.currenColorField=document.getElementById("current_color"),this.currentColorIcon=document.querySelector(".icon_color--current-color"),this.prevColorIcon=document.querySelector(".icon_color--prev_color"),this.currentColor=window.getComputedStyle(this.currentColorIcon).backgroundColor,this.currentTool=null,this.isPencilDrawStart=!1,this.pencilX=0,this.pencilY=0,this.toolsActions={paintBucket:"fillArea",pencil:"drawByPencil",colorPicker:"chooseColor"},this.keyBindingsCodes=["KeyB","KeyP","KeyC"],this.keyBindingsTools={KeyB:"paintBucket",KeyC:"colorPicker",KeyP:"pencil"},this.eventsTypes={mousedown:"mousedown",mouseup:"mouseup",mousemove:"mousemove"}):o.showMessage(`Error: canvas element with id ${t} was not found.`)):o.showMessage("Error: canvasId is not set.")}get pixelSize(){return this.width/this.pixels}setEvents(){this.canvasTools=document.querySelectorAll("[data-action]"),this.colorChangeElems=document.querySelectorAll(".item--color_change");const t=document.querySelectorAll(".canvas_change");document.addEventListener("keyup",this.manageKeyBindings.bind(this)),this.canvasTools.forEach(t=>{const{action:e}=t.dataset;t.addEventListener("click",this[e].bind(this,t))}),this.canvas.addEventListener("mousedown",this.manageCanvasActions.bind(this)),this.canvas.addEventListener("mouseup",this.manageCanvasActions.bind(this)),this.canvas.addEventListener("mousemove",this.manageCanvasActions.bind(this)),this.currenColorField.addEventListener("change",this.changeCurrentColor.bind(this)),this.colorChangeElems.forEach(t=>{t.addEventListener("click",this.setCurrentColor.bind(this,t))}),t.forEach(t=>{t.classList.contains("active")&&this.changeCanvasSize.bind(t),t.addEventListener("click",this.changeCanvasSize.bind(this,t))})}removeToolsActiveClass(){this.canvasTools.forEach(t=>{t.classList.remove("active")})}clearCanvas(){this.resetTools(),this.ctx.clearRect(0,0,this.width,this.height)}manageCanvasActions(t){const e=this.toolsActions[this.currentTool];e&&this[e](t)}resetTools(){this.removeToolsActiveClass(),this.canvas.classList.remove(this.currentTool),this.currentTool=null,this.isPencilDrawStart=!1,this.pencilX=0,this.pencilY=0}setTool(t){this.removeToolsActiveClass(),t.classList.add("active");const{tool:e}=t.dataset;this.canvas.classList.remove(this.currentTool),this.currentTool=e,this.canvas.classList.add(this.currentTool)}manageKeyBindings(t){this.keyBindingsCodes.includes(t.code)&&document.querySelector(`[data-tool="${this.keyBindingsTools[t.code]}"]`).click()}fillArea(t){t.type===this.eventsTypes.mousedown&&(this.ctx.fillStyle=this.currentColor,this.ctx.fillRect(0,0,this.width,this.height))}chooseColor(t){if(t.type===this.eventsTypes.mousedown){const e=this.getPointedColor(t.clientX,t.clientY);this.setPrevColor(this.currentColor),this.currentColor=e,this.currenColorField.value=e,this.setColorIconColor(this.currenColorField,e)}}drawByPencil(t){const e=this.getPointerPosition(t.clientX,t.clientY);t.type===this.eventsTypes.mousedown?(this.isPencilDrawStart=!0,this.drawPixel(e),this.pencilX=e.x,this.pencilY=e.y):t.type===this.eventsTypes.mousemove&&this.isPencilDrawStart?this.drawLine(this.pencilX,this.pencilY,e.x,e.y):t.type===this.eventsTypes.mouseup&&(this.isPencilDrawStart=!1)}drawLine(t,e,i,o){Math.abs(o-e)<Math.abs(i-t)?t>i?this.drawLineLow(i,o,t,e):this.drawLineLow(t,e,i,o):e>o?this.drawLineHigh(i,o,t,e):this.drawLineHigh(t,e,i,o),this.pencilX=i,this.pencilY=o}drawLineLow(t,e,i,o){const s=i-t;let n=o-e,r=1;n<0&&(r=-1,n=-n);let c=2*n-s,l=e;for(let e=t;e<=i;e+=1)this.drawPixel({x:e,y:l}),c>0&&(l+=r,c-=2*s),c+=2*n}drawLineHigh(t,e,i,o){let s=i-t;const n=o-e;let r=1;s<0&&(r=-1,s=-s);let c=2*s-n,l=t;for(let t=e;t<=o;t+=1)this.drawPixel({x:l,y:t}),c>0&&(l+=r,c-=2*n),c+=2*s}drawPixel(t){this.ctx.fillStyle=this.currentColor,this.ctx.fillRect(t.x*this.pixelSize,t.y*this.pixelSize,this.pixelSize,this.pixelSize)}getPointerPosition(t,e){const i=this.canvas.getBoundingClientRect();return{x:Math.floor((t-i.left)/this.pixelSize),y:Math.floor((e-i.top)/this.pixelSize)}}getPointedColor(t,e){const i=this.canvas.getBoundingClientRect(),s=t-i.left,n=e-i.top;let r=this.ctx.getImageData(s,n,1,1).data;return r=o.getColor(r)}changeCurrentColor(t){const e=t.target,i=e.value;this.setPrevColor(this.currentColor),this.currentColor=i,this.setColorIconColor(e,i)}static setColorIconColor(t,e){t.closest(".tools_group__item").querySelector(".icon_color").style.backgroundColor=e}setPrevColor(t){this.prevColor=t,this.prevColorIcon.style.backgroundColor=t}setCurrentColor(t){const e=t.querySelector(".icon_color"),i=window.getComputedStyle(e).backgroundColor;this.currentColor=i,this.currenColorField.value=i,this.currentColorIcon.style.backgroundColor=i}changeCanvasSize(t){const e=t.classList;e.contains("active")||(document.querySelector(".canvas_change.active").classList.remove("active"),e.add("active"),this.pixels=t.dataset.pixels,this.clearCanvas())}init(){this.setEvents()}}document.addEventListener("DOMContentLoaded",(function(){new s("palette").init()}))},function(t,e){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2NhbnZhcy5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvanMvaW5kZXguanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJIZWxwZXJzIiwiY29sb3IiLCJyZ2JhQ29sb3IiLCJsZW5ndGgiLCJ0b0ZpeGVkIiwiam9pbiIsImUiLCJtZXNzYWdlIiwiYWxlcnQiLCJjYW52YXNJZCIsInRoaXMiLCJjYW52YXMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwid2lkdGgiLCJoZWlnaHQiLCJjdHgiLCJnZXRDb250ZXh0IiwicGl4ZWxzIiwiY3VycmVuQ29sb3JGaWVsZCIsImN1cnJlbnRDb2xvckljb24iLCJxdWVyeVNlbGVjdG9yIiwicHJldkNvbG9ySWNvbiIsImN1cnJlbnRDb2xvciIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJjdXJyZW50VG9vbCIsImlzUGVuY2lsRHJhd1N0YXJ0IiwicGVuY2lsWCIsInBlbmNpbFkiLCJ0b29sc0FjdGlvbnMiLCJwYWludEJ1Y2tldCIsInBlbmNpbCIsImNvbG9yUGlja2VyIiwia2V5QmluZGluZ3NDb2RlcyIsImtleUJpbmRpbmdzVG9vbHMiLCJLZXlCIiwiS2V5QyIsIktleVAiLCJldmVudHNUeXBlcyIsIm1vdXNlZG93biIsIm1vdXNldXAiLCJtb3VzZW1vdmUiLCJzaG93TWVzc2FnZSIsImNhbnZhc1Rvb2xzIiwicXVlcnlTZWxlY3RvckFsbCIsImNvbG9yQ2hhbmdlRWxlbXMiLCJjYW52YXNDaGFuZ2VFbGVtcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJtYW5hZ2VLZXlCaW5kaW5ncyIsImZvckVhY2giLCJ0b29sSXRlbSIsImFjdGlvbiIsImRhdGFzZXQiLCJtYW5hZ2VDYW52YXNBY3Rpb25zIiwiY2hhbmdlQ3VycmVudENvbG9yIiwiZWxlbSIsInNldEN1cnJlbnRDb2xvciIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiY2hhbmdlQ2FudmFzU2l6ZSIsInJlbW92ZSIsInJlc2V0VG9vbHMiLCJjbGVhclJlY3QiLCJyZW1vdmVUb29sc0FjdGl2ZUNsYXNzIiwiYWRkIiwidG9vbCIsImluY2x1ZGVzIiwiY29kZSIsImNsaWNrIiwidHlwZSIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwiZ2V0UG9pbnRlZENvbG9yIiwiY2xpZW50WCIsImNsaWVudFkiLCJzZXRQcmV2Q29sb3IiLCJzZXRDb2xvckljb25Db2xvciIsImNvb3JkaW5hdGVzIiwiZ2V0UG9pbnRlclBvc2l0aW9uIiwiZHJhd1BpeGVsIiwieCIsInkiLCJkcmF3TGluZSIsIngwIiwieTAiLCJ4MSIsInkxIiwiTWF0aCIsImFicyIsImRyYXdMaW5lTG93IiwiZHJhd0xpbmVIaWdoIiwiZGVsdGFYIiwiZGVsdGFZIiwiZGlyIiwiZGlmZiIsInBpeGVsU2l6ZSIsInJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJmbG9vciIsImxlZnQiLCJ0b3AiLCJnZXRJbWFnZURhdGEiLCJkYXRhIiwiZ2V0Q29sb3IiLCJmaWVsZCIsInRhcmdldCIsImNsb3Nlc3QiLCJzdHlsZSIsInByZXZDb2xvciIsImljb24iLCJlbGVtQ2xhc3Nl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QUVoQnhELEtBQUtRLE9BQVN1QyxFQUFLSCxRQUFRcEMsT0FDM0JSLEtBQUt1RyxlQUdQLE9BQ0V2RyxLQUFLd0csYUN6U1R0RyxTQUFTcUMsaUJBQWlCLG9CQUwxQixXQUNrQixJQUFJLEVBQU8sV0FDbkJrRSxXIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBIZWxwZXJzIHtcbiAgc3RhdGljIGdldENvbG9yKGNvbG9yKSB7XG4gICAgY29uc3QgZGVmYXVsdENvbG9yID0gJyMwMDAnO1xuXG4gICAgaWYgKHR5cGVvZiBjb2xvciA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBgIyR7Y29sb3J9YDtcbiAgICB9XG5cbiAgICBsZXQgcmdiYUNvbG9yID0gWy4uLmNvbG9yXTtcblxuICAgIHRyeSB7XG4gICAgICByZ2JhQ29sb3JbM10gPSByZ2JhQ29sb3IubGVuZ3RoID09PSA0ID8gKHJnYmFDb2xvclszXSAvIDI1NSkudG9GaXhlZCgyKSA6IDE7XG4gICAgICByZ2JhQ29sb3IgPSBgcmdiYSgke3JnYmFDb2xvci5qb2luKCcsJyl9KWA7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRDb2xvcjtcbiAgICB9XG5cbiAgICByZXR1cm4gcmdiYUNvbG9yO1xuICB9XG5cbiAgc3RhdGljIHNob3dNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICBhbGVydChtZXNzYWdlKTtcbiAgfVxufVxuIiwiaW1wb3J0IEhlbHBlcnMgZnJvbSAnLi9oZWxwZXJzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FudmFzIHtcbiAgY29uc3RydWN0b3IoY2FudmFzSWQpIHtcbiAgICBpZiAoIWNhbnZhc0lkKSB7XG4gICAgICBIZWxwZXJzLnNob3dNZXNzYWdlKCdFcnJvcjogY2FudmFzSWQgaXMgbm90IHNldC4nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNhbnZhc0lkKTtcblxuICAgIGlmICghdGhpcy5jYW52YXMpIHtcbiAgICAgIEhlbHBlcnMuc2hvd01lc3NhZ2UoYEVycm9yOiBjYW52YXMgZWxlbWVudCB3aXRoIGlkICR7Y2FudmFzSWR9IHdhcyBub3QgZm91bmQuYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy53aWR0aCA9IHRoaXMuY2FudmFzLndpZHRoO1xuICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5jYW52YXMuaGVpZ2h0O1xuICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICB0aGlzLnBpeGVscyA9IDQ7XG5cbiAgICB0aGlzLmN1cnJlbkNvbG9yRmllbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VycmVudF9jb2xvcicpO1xuICAgIHRoaXMuY3VycmVudENvbG9ySWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pY29uX2NvbG9yLS1jdXJyZW50LWNvbG9yJyk7XG4gICAgdGhpcy5wcmV2Q29sb3JJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmljb25fY29sb3ItLXByZXZfY29sb3InKTtcbiAgICB0aGlzLmN1cnJlbnRDb2xvciA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMuY3VycmVudENvbG9ySWNvbikuYmFja2dyb3VuZENvbG9yO1xuXG4gICAgdGhpcy5jdXJyZW50VG9vbCA9IG51bGw7XG4gICAgdGhpcy5pc1BlbmNpbERyYXdTdGFydCA9IGZhbHNlO1xuICAgIHRoaXMucGVuY2lsWCA9IDA7XG4gICAgdGhpcy5wZW5jaWxZID0gMDtcblxuICAgIHRoaXMudG9vbHNBY3Rpb25zID0ge1xuICAgICAgcGFpbnRCdWNrZXQ6ICdmaWxsQXJlYScsXG4gICAgICBwZW5jaWw6ICdkcmF3QnlQZW5jaWwnLFxuICAgICAgY29sb3JQaWNrZXI6ICdjaG9vc2VDb2xvcicsXG4gICAgfTtcblxuICAgIHRoaXMua2V5QmluZGluZ3NDb2RlcyA9IFsnS2V5QicsICdLZXlQJywgJ0tleUMnXTtcblxuICAgIHRoaXMua2V5QmluZGluZ3NUb29scyA9IHtcbiAgICAgIEtleUI6ICdwYWludEJ1Y2tldCcsXG4gICAgICBLZXlDOiAnY29sb3JQaWNrZXInLFxuICAgICAgS2V5UDogJ3BlbmNpbCcsXG4gICAgfTtcblxuICAgIHRoaXMuZXZlbnRzVHlwZXMgPSB7XG4gICAgICBtb3VzZWRvd246ICdtb3VzZWRvd24nLFxuICAgICAgbW91c2V1cDogJ21vdXNldXAnLFxuICAgICAgbW91c2Vtb3ZlOiAnbW91c2Vtb3ZlJyxcbiAgICB9O1xuICB9XG5cbiAgZ2V0IHBpeGVsU2l6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy53aWR0aCAvIHRoaXMucGl4ZWxzO1xuICB9XG5cbiAgc2V0RXZlbnRzKCkge1xuICAgIHRoaXMuY2FudmFzVG9vbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1hY3Rpb25dJyk7XG4gICAgdGhpcy5jb2xvckNoYW5nZUVsZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLml0ZW0tLWNvbG9yX2NoYW5nZScpO1xuICAgIGNvbnN0IGNhbnZhc0NoYW5nZUVsZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNhbnZhc19jaGFuZ2UnKTtcblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5tYW5hZ2VLZXlCaW5kaW5ncy5iaW5kKHRoaXMpKTtcblxuICAgIHRoaXMuY2FudmFzVG9vbHMuZm9yRWFjaCgodG9vbEl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IHsgYWN0aW9uIH0gPSB0b29sSXRlbS5kYXRhc2V0O1xuICAgICAgdG9vbEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzW2FjdGlvbl0uYmluZCh0aGlzLCB0b29sSXRlbSkpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5tYW5hZ2VDYW52YXNBY3Rpb25zLmJpbmQodGhpcykpO1xuICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLm1hbmFnZUNhbnZhc0FjdGlvbnMuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5tYW5hZ2VDYW52YXNBY3Rpb25zLmJpbmQodGhpcykpO1xuXG4gICAgdGhpcy5jdXJyZW5Db2xvckZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMuY2hhbmdlQ3VycmVudENvbG9yLmJpbmQodGhpcykpO1xuXG4gICAgdGhpcy5jb2xvckNoYW5nZUVsZW1zLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnNldEN1cnJlbnRDb2xvci5iaW5kKHRoaXMsIGVsZW0pKTtcbiAgICB9KTtcblxuICAgIGNhbnZhc0NoYW5nZUVsZW1zLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgIGNvbnN0IGVsZW1DbGFzc2VzID0gZWxlbS5jbGFzc0xpc3Q7XG5cbiAgICAgIGlmIChlbGVtQ2xhc3Nlcy5jb250YWlucygnYWN0aXZlJykpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VDYW52YXNTaXplLmJpbmQoZWxlbSk7XG4gICAgICB9XG5cbiAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNoYW5nZUNhbnZhc1NpemUuYmluZCh0aGlzLCBlbGVtKSk7XG4gICAgfSk7XG4gIH1cblxuICByZW1vdmVUb29sc0FjdGl2ZUNsYXNzKCkge1xuICAgIHRoaXMuY2FudmFzVG9vbHMuZm9yRWFjaCgoZWxlbSkgPT4ge1xuICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsZWFyQ2FudmFzKCkge1xuICAgIHRoaXMucmVzZXRUb29scygpO1xuICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gIH1cblxuICBtYW5hZ2VDYW52YXNBY3Rpb25zKGUpIHtcbiAgICBjb25zdCBhY3Rpb24gPSB0aGlzLnRvb2xzQWN0aW9uc1t0aGlzLmN1cnJlbnRUb29sXTtcblxuICAgIGlmIChhY3Rpb24pIHtcbiAgICAgIHRoaXNbYWN0aW9uXShlKTtcbiAgICB9XG4gIH1cblxuICByZXNldFRvb2xzKCkge1xuICAgIHRoaXMucmVtb3ZlVG9vbHNBY3RpdmVDbGFzcygpO1xuICAgIHRoaXMuY2FudmFzLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jdXJyZW50VG9vbCk7XG4gICAgdGhpcy5jdXJyZW50VG9vbCA9IG51bGw7XG4gICAgdGhpcy5pc1BlbmNpbERyYXdTdGFydCA9IGZhbHNlO1xuICAgIHRoaXMucGVuY2lsWCA9IDA7XG4gICAgdGhpcy5wZW5jaWxZID0gMDtcbiAgfVxuXG4gIHNldFRvb2wodG9vbEl0ZW0pIHtcbiAgICB0aGlzLnJlbW92ZVRvb2xzQWN0aXZlQ2xhc3MoKTtcbiAgICB0b29sSXRlbS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcblxuICAgIGNvbnN0IHsgdG9vbCB9ID0gdG9vbEl0ZW0uZGF0YXNldDtcbiAgICB0aGlzLmNhbnZhcy5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY3VycmVudFRvb2wpO1xuICAgIHRoaXMuY3VycmVudFRvb2wgPSB0b29sO1xuICAgIHRoaXMuY2FudmFzLmNsYXNzTGlzdC5hZGQodGhpcy5jdXJyZW50VG9vbCk7XG4gIH1cblxuICBtYW5hZ2VLZXlCaW5kaW5ncyhlKSB7XG4gICAgaWYgKHRoaXMua2V5QmluZGluZ3NDb2Rlcy5pbmNsdWRlcyhlLmNvZGUpKSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS10b29sPVwiJHt0aGlzLmtleUJpbmRpbmdzVG9vbHNbZS5jb2RlXX1cIl1gKS5jbGljaygpO1xuICAgIH1cbiAgfVxuXG4gIGZpbGxBcmVhKGUpIHtcbiAgICBpZiAoZS50eXBlID09PSB0aGlzLmV2ZW50c1R5cGVzLm1vdXNlZG93bikge1xuICAgICAgLyogY29uc3QgY29vcmRpbmF0ZXMgPSB0aGlzLmdldFBvaW50ZXJQb3NpdGlvbihlLmNsaWVudFgsIGUuY2xpZW50WSk7XG5cbiAgICAgIGNvbnN0IGNvbG9yID0gdGhpcy5nZXRQb2ludGVkQ29sb3IoZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuXG4gICAgICBpZiAoY29sb3IgPT09IHRoaXMuY3VycmVudENvbG9yKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gKi9cbiAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IHRoaXMuY3VycmVudENvbG9yO1xuICAgICAgdGhpcy5jdHguZmlsbFJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIGNob29zZUNvbG9yKGUpIHtcbiAgICBpZiAoZS50eXBlID09PSB0aGlzLmV2ZW50c1R5cGVzLm1vdXNlZG93bikge1xuICAgICAgY29uc3QgY29sb3IgPSB0aGlzLmdldFBvaW50ZWRDb2xvcihlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgICB0aGlzLnNldFByZXZDb2xvcih0aGlzLmN1cnJlbnRDb2xvcik7XG4gICAgICB0aGlzLmN1cnJlbnRDb2xvciA9IGNvbG9yO1xuICAgICAgdGhpcy5jdXJyZW5Db2xvckZpZWxkLnZhbHVlID0gY29sb3I7XG4gICAgICB0aGlzLnNldENvbG9ySWNvbkNvbG9yKHRoaXMuY3VycmVuQ29sb3JGaWVsZCwgY29sb3IpO1xuICAgIH1cbiAgfVxuXG4gIGRyYXdCeVBlbmNpbChlKSB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSB0aGlzLmdldFBvaW50ZXJQb3NpdGlvbihlLmNsaWVudFgsIGUuY2xpZW50WSk7XG5cbiAgICBpZiAoZS50eXBlID09PSB0aGlzLmV2ZW50c1R5cGVzLm1vdXNlZG93bikge1xuICAgICAgdGhpcy5pc1BlbmNpbERyYXdTdGFydCA9IHRydWU7XG4gICAgICB0aGlzLmRyYXdQaXhlbChjb29yZGluYXRlcyk7XG4gICAgICB0aGlzLnBlbmNpbFggPSBjb29yZGluYXRlcy54O1xuICAgICAgdGhpcy5wZW5jaWxZID0gY29vcmRpbmF0ZXMueTtcbiAgICB9IGVsc2UgaWYgKGUudHlwZSA9PT0gdGhpcy5ldmVudHNUeXBlcy5tb3VzZW1vdmUgJiYgdGhpcy5pc1BlbmNpbERyYXdTdGFydCkge1xuICAgICAgdGhpcy5kcmF3TGluZSh0aGlzLnBlbmNpbFgsIHRoaXMucGVuY2lsWSwgY29vcmRpbmF0ZXMueCwgY29vcmRpbmF0ZXMueSk7XG4gICAgfSBlbHNlIGlmIChlLnR5cGUgPT09IHRoaXMuZXZlbnRzVHlwZXMubW91c2V1cCkge1xuICAgICAgdGhpcy5pc1BlbmNpbERyYXdTdGFydCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG5cbiAgZHJhd0xpbmUoeDAsIHkwLCB4MSwgeTEpIHtcbiAgICBpZiAoTWF0aC5hYnMoeTEgLSB5MCkgPCBNYXRoLmFicyh4MSAtIHgwKSkge1xuICAgICAgaWYgKHgwID4geDEpIHtcbiAgICAgICAgdGhpcy5kcmF3TGluZUxvdyh4MSwgeTEsIHgwLCB5MCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRyYXdMaW5lTG93KHgwLCB5MCwgeDEsIHkxKTtcbiAgICAgIH1cbiAgICB9IGVsc2VcbiAgICBpZiAoeTAgPiB5MSkge1xuICAgICAgdGhpcy5kcmF3TGluZUhpZ2goeDEsIHkxLCB4MCwgeTApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRyYXdMaW5lSGlnaCh4MCwgeTAsIHgxLCB5MSk7XG4gICAgfVxuXG4gICAgdGhpcy5wZW5jaWxYID0geDE7XG4gICAgdGhpcy5wZW5jaWxZID0geTE7XG4gIH1cblxuICBkcmF3TGluZUxvdyh4MCwgeTAsIHgxLCB5MSkge1xuICAgIGNvbnN0IGRlbHRhWCA9IHgxIC0geDA7XG4gICAgbGV0IGRlbHRhWSA9IHkxIC0geTA7XG4gICAgbGV0IGRpciA9IDE7XG4gICAgaWYgKGRlbHRhWSA8IDApIHtcbiAgICAgIGRpciA9IC0xO1xuICAgICAgZGVsdGFZID0gLWRlbHRhWTtcbiAgICB9XG5cbiAgICBsZXQgZGlmZiA9IDIgKiBkZWx0YVkgLSBkZWx0YVg7XG4gICAgbGV0IHkgPSB5MDtcblxuICAgIGZvciAobGV0IHggPSB4MDsgeCA8PSB4MTsgeCArPSAxKSB7XG4gICAgICB0aGlzLmRyYXdQaXhlbCh7IHgsIHkgfSk7XG4gICAgICBpZiAoZGlmZiA+IDApIHtcbiAgICAgICAgeSArPSBkaXI7XG4gICAgICAgIGRpZmYgLT0gMiAqIGRlbHRhWDtcbiAgICAgIH1cblxuICAgICAgZGlmZiArPSAyICogZGVsdGFZO1xuICAgIH1cbiAgfVxuXG4gIGRyYXdMaW5lSGlnaCh4MCwgeTAsIHgxLCB5MSkge1xuICAgIGxldCBkZWx0YVggPSB4MSAtIHgwO1xuICAgIGNvbnN0IGRlbHRhWSA9IHkxIC0geTA7XG5cbiAgICBsZXQgZGlyID0gMTtcbiAgICBpZiAoZGVsdGFYIDwgMCkge1xuICAgICAgZGlyID0gLTE7XG4gICAgICBkZWx0YVggPSAtZGVsdGFYO1xuICAgIH1cblxuICAgIGxldCBkaWZmID0gMiAqIGRlbHRhWCAtIGRlbHRhWTtcbiAgICBsZXQgeCA9IHgwO1xuXG4gICAgZm9yIChsZXQgeSA9IHkwOyB5IDw9IHkxOyB5ICs9IDEpIHtcbiAgICAgIHRoaXMuZHJhd1BpeGVsKHsgeCwgeSB9KTtcbiAgICAgIGlmIChkaWZmID4gMCkge1xuICAgICAgICB4ICs9IGRpcjtcbiAgICAgICAgZGlmZiAtPSAyICogZGVsdGFZO1xuICAgICAgfVxuXG4gICAgICBkaWZmICs9IDIgKiBkZWx0YVg7XG4gICAgfVxuICB9XG5cbiAgZHJhd1BpeGVsKGNvb3JkaW5hdGVzKSB7XG4gICAgdGhpcy5jdHguZmlsbFN0eWxlID0gdGhpcy5jdXJyZW50Q29sb3I7XG4gICAgdGhpcy5jdHguZmlsbFJlY3QoXG4gICAgICBjb29yZGluYXRlcy54ICogdGhpcy5waXhlbFNpemUsXG4gICAgICBjb29yZGluYXRlcy55ICogdGhpcy5waXhlbFNpemUsXG4gICAgICB0aGlzLnBpeGVsU2l6ZSxcbiAgICAgIHRoaXMucGl4ZWxTaXplLFxuICAgICk7XG4gIH1cblxuICBnZXRQb2ludGVyUG9zaXRpb24oY2xpZW50WCwgY2xpZW50WSkge1xuICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCB4ID0gTWF0aC5mbG9vcigoY2xpZW50WCAtIHJlY3QubGVmdCkgLyB0aGlzLnBpeGVsU2l6ZSk7XG4gICAgY29uc3QgeSA9IE1hdGguZmxvb3IoKGNsaWVudFkgLSByZWN0LnRvcCkgLyB0aGlzLnBpeGVsU2l6ZSk7XG5cbiAgICByZXR1cm4geyB4LCB5IH07XG4gIH1cblxuICBnZXRQb2ludGVkQ29sb3IoY2xpZW50WCwgY2xpZW50WSkge1xuICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCB4ID0gY2xpZW50WCAtIHJlY3QubGVmdDtcbiAgICBjb25zdCB5ID0gY2xpZW50WSAtIHJlY3QudG9wO1xuICAgIGxldCBjb2xvciA9IHRoaXMuY3R4LmdldEltYWdlRGF0YSh4LCB5LCAxLCAxKS5kYXRhO1xuICAgIGNvbG9yID0gSGVscGVycy5nZXRDb2xvcihjb2xvcik7XG5cbiAgICByZXR1cm4gY29sb3I7XG4gIH1cblxuICBjaGFuZ2VDdXJyZW50Q29sb3IoZSkge1xuICAgIGNvbnN0IGZpZWxkID0gZS50YXJnZXQ7XG4gICAgY29uc3QgY29sb3IgPSBmaWVsZC52YWx1ZTtcbiAgICB0aGlzLnNldFByZXZDb2xvcih0aGlzLmN1cnJlbnRDb2xvcik7XG4gICAgdGhpcy5jdXJyZW50Q29sb3IgPSBjb2xvcjtcbiAgICB0aGlzLnNldENvbG9ySWNvbkNvbG9yKGZpZWxkLCBjb2xvcik7XG4gIH1cblxuICBzdGF0aWMgc2V0Q29sb3JJY29uQ29sb3IoZmllbGQsIGNvbG9yKSB7XG4gICAgY29uc3QgaWNvbiA9IGZpZWxkLmNsb3Nlc3QoJy50b29sc19ncm91cF9faXRlbScpLnF1ZXJ5U2VsZWN0b3IoJy5pY29uX2NvbG9yJyk7XG4gICAgaWNvbi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjtcbiAgfVxuXG4gIHNldFByZXZDb2xvcihjb2xvcikge1xuICAgIHRoaXMucHJldkNvbG9yID0gY29sb3I7XG4gICAgdGhpcy5wcmV2Q29sb3JJY29uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuICB9XG5cbiAgc2V0Q3VycmVudENvbG9yKGVsZW0pIHtcbiAgICBjb25zdCBpY29uID0gZWxlbS5xdWVyeVNlbGVjdG9yKCcuaWNvbl9jb2xvcicpO1xuICAgIGNvbnN0IGNvbG9yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoaWNvbikuYmFja2dyb3VuZENvbG9yO1xuICAgIHRoaXMuY3VycmVudENvbG9yID0gY29sb3I7XG4gICAgdGhpcy5jdXJyZW5Db2xvckZpZWxkLnZhbHVlID0gY29sb3I7XG4gICAgdGhpcy5jdXJyZW50Q29sb3JJY29uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuICB9XG5cbiAgY2hhbmdlQ2FudmFzU2l6ZShlbGVtKSB7XG4gICAgY29uc3QgZWxlbUNsYXNzZXMgPSBlbGVtLmNsYXNzTGlzdDtcblxuICAgIGlmIChlbGVtQ2xhc3Nlcy5jb250YWlucygnYWN0aXZlJykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBhY3RpdmVFbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNhbnZhc19jaGFuZ2UuYWN0aXZlJyk7XG4gICAgYWN0aXZlRWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICBlbGVtQ2xhc3Nlcy5hZGQoJ2FjdGl2ZScpO1xuXG4gICAgdGhpcy5waXhlbHMgPSBlbGVtLmRhdGFzZXQucGl4ZWxzO1xuICAgIHRoaXMuY2xlYXJDYW52YXMoKTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgdGhpcy5zZXRFdmVudHMoKTtcbiAgfVxufVxuIiwiaW1wb3J0ICcuLi9zdHlsZXMvc3R5bGUuY3NzJztcblxuLy8gaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IENhbnZhcyBmcm9tICcuL2NhbnZhcyc7XG5cbmZ1bmN0aW9uIGluaXQoKSB7XG4gIGNvbnN0IHBhbGV0dGUgPSBuZXcgQ2FudmFzKCdwYWxldHRlJyk7XG4gIHBhbGV0dGUuaW5pdCgpO1xufVxuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgaW5pdCk7XG4iXSwic291cmNlUm9vdCI6IiJ9