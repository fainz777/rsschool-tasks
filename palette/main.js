!function(t){var e={};function s(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(i,o,function(e){return t[e]}.bind(null,o));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);s(1);class i{static getColor(t){if("string"==typeof t)return`#${t}`;let e=[...t];try{e[3]=4===e.length?(e[3]/255).toFixed(2):1,e=`rgba(${e.join(",")})`}catch(t){return"#000"}return e}static showMessage(t){alert(t)}}class o{constructor(t){t?(this.canvasId=t,this.canvas=document.getElementById(this.canvasId),this.canvas?(this.width=this.canvas.width,this.height=this.canvas.height,this.ctx=this.canvas.getContext("2d"),this.pixels=4,this.currenColorField=document.getElementById("current_color"),this.currentColorIcon=document.querySelector(".icon_color--current-color"),this.prevColorIcon=document.querySelector(".icon_color--prev_color"),this.currentColor=window.getComputedStyle(this.currentColorIcon).backgroundColor,this.currentTool=null,this.isPencilDrawStart=!1,this.pencilX=0,this.pencilY=0,this.toolsActions={paintBucket:"fillArea",pencil:"drawByPencil",colorPicker:"chooseColor"},this.keyBindingsCodes=["KeyB","KeyP","KeyC"],this.keyBindingsTools={KeyB:"paintBucket",KeyC:"colorPicker",KeyP:"pencil"},this.eventsTypes={mousedown:"mousedown",mouseup:"mouseup",mousemove:"mousemove"}):i.showMessage(`Error: canvas element with id ${t} was not found.`)):i.showMessage("Error: canvasId is not set.")}get pixelSize(){return this.width/this.pixels}setEvents(){this.canvasTools=document.querySelectorAll("[data-action]"),this.colorChangeElems=document.querySelectorAll(".item--color_change");const t=document.querySelectorAll(".canvas_change");document.addEventListener("keyup",this.manageKeyBindings.bind(this)),this.canvasTools.forEach(t=>{const{action:e}=t.dataset;t.addEventListener("click",this[e].bind(this,t))}),this.canvas.addEventListener("mousedown",this.manageCanvasActions.bind(this)),this.canvas.addEventListener("mouseup",this.manageCanvasActions.bind(this)),this.canvas.addEventListener("mousemove",this.manageCanvasActions.bind(this)),this.currenColorField.addEventListener("change",this.changeCurrentColor.bind(this)),this.colorChangeElems.forEach(t=>{t.addEventListener("click",this.setCurrentColor.bind(this,t))}),t.forEach(t=>{t.classList.contains("active")&&this.changeCanvasSize.bind(t),t.addEventListener("click",this.changeCanvasSize.bind(this,t))})}removeToolsActiveClass(){this.canvasTools.forEach(t=>{t.classList.remove("active")})}clearCanvas(){this.resetTools(),this.ctx.clearRect(0,0,this.width,this.height)}manageCanvasActions(t){const e=this.toolsActions[this.currentTool];e&&this[e](t)}resetTools(){this.removeToolsActiveClass(),this.canvas.classList.remove(this.currentTool),this.currentTool=null,this.isPencilDrawStart=!1,this.pencilX=0,this.pencilY=0}setTool(t){this.removeToolsActiveClass(),t.classList.add("active");const{tool:e}=t.dataset;this.canvas.classList.remove(this.currentTool),this.currentTool=e,this.canvas.classList.add(this.currentTool)}manageKeyBindings(t){this.keyBindingsCodes.includes(t.code)&&document.querySelector(`[data-tool="${this.keyBindingsTools[t.code]}"]`).click()}fillArea(t){t.type===this.eventsTypes.mousedown&&(this.ctx.fillStyle=this.currentColor,this.ctx.fillRect(0,0,this.width,this.height),this.saveCanvasState())}chooseColor(t){if(t.type===this.eventsTypes.mousedown){const e=this.getPointedColor(t.clientX,t.clientY);this.setPrevColor(this.currentColor),this.currentColor=e,this.currenColorField.value=e,this.setCurrentIconColor(this.currenColorField,e)}}drawByPencil(t){const e=this.getPointerPosition(t.clientX,t.clientY);t.type===this.eventsTypes.mousedown?(this.isPencilDrawStart=!0,this.drawPixel(e),this.pencilX=e.x,this.pencilY=e.y,this.saveCanvasState()):t.type===this.eventsTypes.mousemove&&this.isPencilDrawStart?(this.drawLine(this.pencilX,this.pencilY,e.x,e.y),this.saveCanvasState()):t.type===this.eventsTypes.mouseup&&(this.isPencilDrawStart=!1)}drawLine(t,e,s,i){Math.abs(i-e)<Math.abs(s-t)?t>s?this.drawLineLow(s,i,t,e):this.drawLineLow(t,e,s,i):e>i?this.drawLineHigh(s,i,t,e):this.drawLineHigh(t,e,s,i),this.pencilX=s,this.pencilY=i}drawLineLow(t,e,s,i){const o=s-t;let n=i-e,r=1;n<0&&(r=-1,n=-n);let a=2*n-o,c=e;for(let e=t;e<=s;e+=1)this.drawPixel({x:e,y:c}),a>0&&(c+=r,a-=2*o),a+=2*n}drawLineHigh(t,e,s,i){let o=s-t;const n=i-e;let r=1;o<0&&(r=-1,o=-o);let a=2*o-n,c=t;for(let t=e;t<=i;t+=1)this.drawPixel({x:c,y:t}),a>0&&(c+=r,a-=2*n),a+=2*o}drawPixel(t){this.ctx.fillStyle=this.currentColor,this.ctx.fillRect(t.x*this.pixelSize,t.y*this.pixelSize,this.pixelSize,this.pixelSize)}getPointerPosition(t,e){const s=this.canvas.getBoundingClientRect();return{x:Math.floor((t-s.left)/this.pixelSize),y:Math.floor((e-s.top)/this.pixelSize)}}getPointedColor(t,e){const s=this.canvas.getBoundingClientRect(),o=t-s.left,n=e-s.top;let r=this.ctx.getImageData(o,n,1,1).data;return r=i.getColor(r)}changeCurrentColor(t){const e=t.target,s=e.value;this.setPrevColor(this.currentColor),this.currentColor=s,this.setCurrentIconColor(e,s)}setCurrentIconColor(t,e){t.closest(".tools_group__item").querySelector(".icon_color").style.backgroundColor=e}setPrevColor(t){this.prevColor=t,this.prevColorIcon.style.backgroundColor=t}setCurrentColor(t){const e=t.querySelector(".icon_color"),s=window.getComputedStyle(e).backgroundColor;this.currentColor=s,this.currenColorField.value=s,this.currentColorIcon.style.backgroundColor=s}drawImage(t){this.ctx.drawImage(t,0,0,this.width,this.height)}changeCanvasSize(t){const e=t.classList;e.contains("active")||(document.querySelector(".canvas_change.active").classList.remove("active"),e.add("active"),this.pixels=t.dataset.pixels,this.clearCanvas())}saveCanvasState(){const t={imageSrc:this.canvas.toDataURL(),pixels:this.pixels};localStorage.setItem(this.canvasId,JSON.stringify(t))}getCanvasState(){const t=localStorage.getItem(this.canvasId);if(t)try{const e=JSON.parse(t);this.pixels=e.pixels;const s=new Image;document.querySelectorAll(".canvas_change").forEach(t=>{t.dataset.pixels===this.pixels?t.classList.add("active"):t.classList.remove("active")}),s.src=e.imageSrc,s.onload=this.drawImage.bind(this,s)}catch(t){alert("Loading saving state was failed. An empty canvas will create.")}}init(){this.getCanvasState(),this.setEvents()}}document.addEventListener("DOMContentLoaded",(function(){new o("palette").init()}))},function(t,e){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2NhbnZhcy5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvanMvaW5kZXguanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJIZWxwZXJzIiwiY29sb3IiLCJyZ2JhQ29sb3IiLCJsZW5ndGgiLCJ0b0ZpeGVkIiwiam9pbiIsImUiLCJtZXNzYWdlIiwiYWxlcnQiLCJjYW52YXNJZCIsInRoaXMiLCJjYW52YXMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwid2lkdGgiLCJoZWlnaHQiLCJjdHgiLCJnZXRDb250ZXh0IiwicGl4ZWxzIiwiY3VycmVuQ29sb3JGaWVsZCIsImN1cnJlbnRDb2xvckljb24iLCJxdWVyeVNlbGVjdG9yIiwicHJldkNvbG9ySWNvbiIsImN1cnJlbnRDb2xvciIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJjdXJyZW50VG9vbCIsImlzUGVuY2lsRHJhd1N0YXJ0IiwicGVuY2lsWCIsInBlbmNpbFkiLCJ0b29sc0FjdGlvbnMiLCJwYWludEJ1Y2tldCIsInBlbmNpbCIsImNvbG9yUGlja2VyIiwia2V5QmluZGluZ3NDb2RlcyIsImtleUJpbmRpbmdzVG9vbHMiLCJLZXlCIiwiS2V5QyIsIktleVAiLCJldmVudHNUeXBlcyIsIm1vdXNlZG93biIsIm1vdXNldXAiLCJtb3VzZW1vdmUiLCJzaG93TWVzc2FnZSIsImNhbnZhc1Rvb2xzIiwicXVlcnlTZWxlY3RvckFsbCIsImNvbG9yQ2hhbmdlRWxlbXMiLCJjYW52YXNDaGFuZ2VFbGVtcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJtYW5hZ2VLZXlCaW5kaW5ncyIsImZvckVhY2giLCJ0b29sSXRlbSIsImFjdGlvbiIsImRhdGFzZXQiLCJtYW5hZ2VDYW52YXNBY3Rpb25zIiwiY2hhbmdlQ3VycmVudENvbG9yIiwiZWxlbSIsInNldEN1cnJlbnRDb2xvciIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiY2hhbmdlQ2FudmFzU2l6ZSIsInJlbW92ZSIsInJlc2V0VG9vbHMiLCJjbGVhclJlY3QiLCJyZW1vdmVUb29sc0FjdGl2ZUNsYXNzIiwiYWRkIiwidG9vbCIsImluY2x1ZGVzIiwiY29kZSIsImNsaWNrIiwidHlwZSIsImZpbGxTdHlsZSIsImZpbGxSZWN0Iiwic2F2ZUNhbnZhc1N0YXRlIiwiZ2V0UG9pbnRlZENvbG9yIiwiY2xpZW50WCIsImNsaWVudFkiLCJzZXRQcmV2Q29sb3IiLCJzZXRDdXJyZW50SWNvbkNvbG9yIiwiY29vcmRpbmF0ZXMiLCJnZXRQb2ludGVyUG9zaXRpb24iLCJkcmF3UGl4ZWwiLCJ4IiwieSIsImRyYXdMaW5lIiwieDAiLCJ5MCIsIngxIiwieTEiLCJNYXRoIiwiYWJzIiwiZHJhd0xpbmVMb3ciLCJkcmF3TGluZUhpZ2giLCJkZWx0YVgiLCJkZWx0YVkiLCJkaXIiLCJkaWZmIiwicGl4ZWxTaXplIiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImZsb29yIiwibGVmdCIsInRvcCIsImdldEltYWdlRGF0YSIsImRhdGEiLCJnZXRDb2xvciIsImZpZWxkIiwidGFyZ2V0IiwiY2xvc2VzdCIsInN0eWxlIiwicHJldkNvbG9yIiwiaWNvbiIsImltYWdlIiwiZHJhd0ltYWdlIiwiZWxlbUNsYXNzZXMiLCJjbGVhckNhbnZhcyIsInBhcmFtcyIsImltYWdlU3JjIiwidG9EYXRhVVJMIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJwYXJhbXNTdHIiLCJnZXRJdGVtIiwicGFyc2UiLCJJbWFnZSIsInNyYyIsIm9ubG9hZCIsImdldENhbnZhc1N0YXRlIiwic2V0RXZlbnRzIiwiaW5pdCJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBS2ZGLEVBQW9CUSxFQUFJRixFQUd4Qk4sRUFBb0JTLEVBQUlWLEVBR3hCQyxFQUFvQlUsRUFBSSxTQUFTUixFQUFTUyxFQUFNQyxHQUMzQ1osRUFBb0JhLEVBQUVYLEVBQVNTLElBQ2xDRyxPQUFPQyxlQUFlYixFQUFTUyxFQUFNLENBQUVLLFlBQVksRUFBTUMsSUFBS0wsS0FLaEVaLEVBQW9Ca0IsRUFBSSxTQUFTaEIsR0FDWCxvQkFBWGlCLFFBQTBCQSxPQUFPQyxhQUMxQ04sT0FBT0MsZUFBZWIsRUFBU2lCLE9BQU9DLFlBQWEsQ0FBRUMsTUFBTyxXQUU3RFAsT0FBT0MsZUFBZWIsRUFBUyxhQUFjLENBQUVtQixPQUFPLEtBUXZEckIsRUFBb0JzQixFQUFJLFNBQVNELEVBQU9FLEdBRXZDLEdBRFUsRUFBUEEsSUFBVUYsRUFBUXJCLEVBQW9CcUIsSUFDL0IsRUFBUEUsRUFBVSxPQUFPRixFQUNwQixHQUFXLEVBQVBFLEdBQThCLGlCQUFWRixHQUFzQkEsR0FB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aUIsb0JBTDFCLFdBQ2tCLElBQUksRUFBTyxXQUNuQm1GLFciLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEhlbHBlcnMge1xuICBzdGF0aWMgZ2V0Q29sb3IoY29sb3IpIHtcbiAgICBjb25zdCBkZWZhdWx0Q29sb3IgPSAnIzAwMCc7XG5cbiAgICBpZiAodHlwZW9mIGNvbG9yID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIGAjJHtjb2xvcn1gO1xuICAgIH1cblxuICAgIGxldCByZ2JhQ29sb3IgPSBbLi4uY29sb3JdO1xuXG4gICAgdHJ5IHtcbiAgICAgIHJnYmFDb2xvclszXSA9IHJnYmFDb2xvci5sZW5ndGggPT09IDQgPyAocmdiYUNvbG9yWzNdIC8gMjU1KS50b0ZpeGVkKDIpIDogMTtcbiAgICAgIHJnYmFDb2xvciA9IGByZ2JhKCR7cmdiYUNvbG9yLmpvaW4oJywnKX0pYDtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdENvbG9yO1xuICAgIH1cblxuICAgIHJldHVybiByZ2JhQ29sb3I7XG4gIH1cblxuICBzdGF0aWMgc2hvd01lc3NhZ2UobWVzc2FnZSkge1xuICAgIGFsZXJ0KG1lc3NhZ2UpO1xuICB9XG59XG4iLCJpbXBvcnQgSGVscGVycyBmcm9tICcuL2hlbHBlcnMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYW52YXMge1xuICBjb25zdHJ1Y3RvcihjYW52YXNJZCkge1xuICAgIGlmICghY2FudmFzSWQpIHtcbiAgICAgIEhlbHBlcnMuc2hvd01lc3NhZ2UoJ0Vycm9yOiBjYW52YXNJZCBpcyBub3Qgc2V0LicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY2FudmFzSWQgPSBjYW52YXNJZDtcbiAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuY2FudmFzSWQpO1xuXG4gICAgaWYgKCF0aGlzLmNhbnZhcykge1xuICAgICAgSGVscGVycy5zaG93TWVzc2FnZShgRXJyb3I6IGNhbnZhcyBlbGVtZW50IHdpdGggaWQgJHtjYW52YXNJZH0gd2FzIG5vdCBmb3VuZC5gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLndpZHRoID0gdGhpcy5jYW52YXMud2lkdGg7XG4gICAgdGhpcy5oZWlnaHQgPSB0aGlzLmNhbnZhcy5oZWlnaHQ7XG4gICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIHRoaXMucGl4ZWxzID0gNDtcblxuICAgIHRoaXMuY3VycmVuQ29sb3JGaWVsZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXJyZW50X2NvbG9yJyk7XG4gICAgdGhpcy5jdXJyZW50Q29sb3JJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmljb25fY29sb3ItLWN1cnJlbnQtY29sb3InKTtcbiAgICB0aGlzLnByZXZDb2xvckljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaWNvbl9jb2xvci0tcHJldl9jb2xvcicpO1xuICAgIHRoaXMuY3VycmVudENvbG9yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5jdXJyZW50Q29sb3JJY29uKS5iYWNrZ3JvdW5kQ29sb3I7XG5cbiAgICB0aGlzLmN1cnJlbnRUb29sID0gbnVsbDtcbiAgICB0aGlzLmlzUGVuY2lsRHJhd1N0YXJ0ID0gZmFsc2U7XG4gICAgdGhpcy5wZW5jaWxYID0gMDtcbiAgICB0aGlzLnBlbmNpbFkgPSAwO1xuXG4gICAgdGhpcy50b29sc0FjdGlvbnMgPSB7XG4gICAgICBwYWludEJ1Y2tldDogJ2ZpbGxBcmVhJyxcbiAgICAgIHBlbmNpbDogJ2RyYXdCeVBlbmNpbCcsXG4gICAgICBjb2xvclBpY2tlcjogJ2Nob29zZUNvbG9yJyxcbiAgICB9O1xuXG4gICAgdGhpcy5rZXlCaW5kaW5nc0NvZGVzID0gWydLZXlCJywgJ0tleVAnLCAnS2V5QyddO1xuXG4gICAgdGhpcy5rZXlCaW5kaW5nc1Rvb2xzID0ge1xuICAgICAgS2V5QjogJ3BhaW50QnVja2V0JyxcbiAgICAgIEtleUM6ICdjb2xvclBpY2tlcicsXG4gICAgICBLZXlQOiAncGVuY2lsJyxcbiAgICB9O1xuXG4gICAgdGhpcy5ldmVudHNUeXBlcyA9IHtcbiAgICAgIG1vdXNlZG93bjogJ21vdXNlZG93bicsXG4gICAgICBtb3VzZXVwOiAnbW91c2V1cCcsXG4gICAgICBtb3VzZW1vdmU6ICdtb3VzZW1vdmUnLFxuICAgIH07XG4gIH1cblxuICBnZXQgcGl4ZWxTaXplKCkge1xuICAgIHJldHVybiB0aGlzLndpZHRoIC8gdGhpcy5waXhlbHM7XG4gIH1cblxuICBzZXRFdmVudHMoKSB7XG4gICAgdGhpcy5jYW52YXNUb29scyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWFjdGlvbl0nKTtcbiAgICB0aGlzLmNvbG9yQ2hhbmdlRWxlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaXRlbS0tY29sb3JfY2hhbmdlJyk7XG4gICAgY29uc3QgY2FudmFzQ2hhbmdlRWxlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2FudmFzX2NoYW5nZScpO1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLm1hbmFnZUtleUJpbmRpbmdzLmJpbmQodGhpcykpO1xuXG4gICAgdGhpcy5jYW52YXNUb29scy5mb3JFYWNoKCh0b29sSXRlbSkgPT4ge1xuICAgICAgY29uc3QgeyBhY3Rpb24gfSA9IHRvb2xJdGVtLmRhdGFzZXQ7XG4gICAgICB0b29sSXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXNbYWN0aW9uXS5iaW5kKHRoaXMsIHRvb2xJdGVtKSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLm1hbmFnZUNhbnZhc0FjdGlvbnMuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMubWFuYWdlQ2FudmFzQWN0aW9ucy5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm1hbmFnZUNhbnZhc0FjdGlvbnMuYmluZCh0aGlzKSk7XG5cbiAgICB0aGlzLmN1cnJlbkNvbG9yRmllbGQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5jaGFuZ2VDdXJyZW50Q29sb3IuYmluZCh0aGlzKSk7XG5cbiAgICB0aGlzLmNvbG9yQ2hhbmdlRWxlbXMuZm9yRWFjaCgoZWxlbSkgPT4ge1xuICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuc2V0Q3VycmVudENvbG9yLmJpbmQodGhpcywgZWxlbSkpO1xuICAgIH0pO1xuXG4gICAgY2FudmFzQ2hhbmdlRWxlbXMuZm9yRWFjaCgoZWxlbSkgPT4ge1xuICAgICAgY29uc3QgZWxlbUNsYXNzZXMgPSBlbGVtLmNsYXNzTGlzdDtcblxuICAgICAgaWYgKGVsZW1DbGFzc2VzLmNvbnRhaW5zKCdhY3RpdmUnKSkge1xuICAgICAgICB0aGlzLmNoYW5nZUNhbnZhc1NpemUuYmluZChlbGVtKTtcbiAgICAgIH1cblxuICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2hhbmdlQ2FudmFzU2l6ZS5iaW5kKHRoaXMsIGVsZW0pKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlbW92ZVRvb2xzQWN0aXZlQ2xhc3MoKSB7XG4gICAgdGhpcy5jYW52YXNUb29scy5mb3JFYWNoKChlbGVtKSA9PiB7XG4gICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgIH0pO1xuICB9XG5cbiAgY2xlYXJDYW52YXMoKSB7XG4gICAgdGhpcy5yZXNldFRvb2xzKCk7XG4gICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgfVxuXG4gIG1hbmFnZUNhbnZhc0FjdGlvbnMoZSkge1xuICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMudG9vbHNBY3Rpb25zW3RoaXMuY3VycmVudFRvb2xdO1xuXG4gICAgaWYgKGFjdGlvbikge1xuICAgICAgdGhpc1thY3Rpb25dKGUpO1xuICAgIH1cbiAgfVxuXG4gIHJlc2V0VG9vbHMoKSB7XG4gICAgdGhpcy5yZW1vdmVUb29sc0FjdGl2ZUNsYXNzKCk7XG4gICAgdGhpcy5jYW52YXMuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmN1cnJlbnRUb29sKTtcbiAgICB0aGlzLmN1cnJlbnRUb29sID0gbnVsbDtcbiAgICB0aGlzLmlzUGVuY2lsRHJhd1N0YXJ0ID0gZmFsc2U7XG4gICAgdGhpcy5wZW5jaWxYID0gMDtcbiAgICB0aGlzLnBlbmNpbFkgPSAwO1xuICB9XG5cbiAgc2V0VG9vbCh0b29sSXRlbSkge1xuICAgIHRoaXMucmVtb3ZlVG9vbHNBY3RpdmVDbGFzcygpO1xuICAgIHRvb2xJdGVtLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuXG4gICAgY29uc3QgeyB0b29sIH0gPSB0b29sSXRlbS5kYXRhc2V0O1xuICAgIHRoaXMuY2FudmFzLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jdXJyZW50VG9vbCk7XG4gICAgdGhpcy5jdXJyZW50VG9vbCA9IHRvb2w7XG4gICAgdGhpcy5jYW52YXMuY2xhc3NMaXN0LmFkZCh0aGlzLmN1cnJlbnRUb29sKTtcbiAgfVxuXG4gIG1hbmFnZUtleUJpbmRpbmdzKGUpIHtcbiAgICBpZiAodGhpcy5rZXlCaW5kaW5nc0NvZGVzLmluY2x1ZGVzKGUuY29kZSkpIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXRvb2w9XCIke3RoaXMua2V5QmluZGluZ3NUb29sc1tlLmNvZGVdfVwiXWApLmNsaWNrKCk7XG4gICAgfVxuICB9XG5cbiAgZmlsbEFyZWEoZSkge1xuICAgIGlmIChlLnR5cGUgPT09IHRoaXMuZXZlbnRzVHlwZXMubW91c2Vkb3duKSB7XG4gICAgICAvKiBjb25zdCBjb29yZGluYXRlcyA9IHRoaXMuZ2V0UG9pbnRlclBvc2l0aW9uKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcblxuICAgICAgY29uc3QgY29sb3IgPSB0aGlzLmdldFBvaW50ZWRDb2xvcihlLmNsaWVudFgsIGUuY2xpZW50WSk7XG5cbiAgICAgIGlmIChjb2xvciA9PT0gdGhpcy5jdXJyZW50Q29sb3IpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAqL1xuICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gdGhpcy5jdXJyZW50Q29sb3I7XG4gICAgICB0aGlzLmN0eC5maWxsUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgICAgIHRoaXMuc2F2ZUNhbnZhc1N0YXRlKCk7XG4gICAgfVxuICB9XG5cbiAgY2hvb3NlQ29sb3IoZSkge1xuICAgIGlmIChlLnR5cGUgPT09IHRoaXMuZXZlbnRzVHlwZXMubW91c2Vkb3duKSB7XG4gICAgICBjb25zdCBjb2xvciA9IHRoaXMuZ2V0UG9pbnRlZENvbG9yKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICAgIHRoaXMuc2V0UHJldkNvbG9yKHRoaXMuY3VycmVudENvbG9yKTtcbiAgICAgIHRoaXMuY3VycmVudENvbG9yID0gY29sb3I7XG4gICAgICB0aGlzLmN1cnJlbkNvbG9yRmllbGQudmFsdWUgPSBjb2xvcjtcbiAgICAgIHRoaXMuc2V0Q3VycmVudEljb25Db2xvcih0aGlzLmN1cnJlbkNvbG9yRmllbGQsIGNvbG9yKTtcbiAgICB9XG4gIH1cblxuICBkcmF3QnlQZW5jaWwoZSkge1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gdGhpcy5nZXRQb2ludGVyUG9zaXRpb24oZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuXG4gICAgaWYgKGUudHlwZSA9PT0gdGhpcy5ldmVudHNUeXBlcy5tb3VzZWRvd24pIHtcbiAgICAgIHRoaXMuaXNQZW5jaWxEcmF3U3RhcnQgPSB0cnVlO1xuICAgICAgdGhpcy5kcmF3UGl4ZWwoY29vcmRpbmF0ZXMpO1xuICAgICAgdGhpcy5wZW5jaWxYID0gY29vcmRpbmF0ZXMueDtcbiAgICAgIHRoaXMucGVuY2lsWSA9IGNvb3JkaW5hdGVzLnk7XG4gICAgICB0aGlzLnNhdmVDYW52YXNTdGF0ZSgpO1xuICAgIH0gZWxzZSBpZiAoZS50eXBlID09PSB0aGlzLmV2ZW50c1R5cGVzLm1vdXNlbW92ZSAmJiB0aGlzLmlzUGVuY2lsRHJhd1N0YXJ0KSB7XG4gICAgICB0aGlzLmRyYXdMaW5lKHRoaXMucGVuY2lsWCwgdGhpcy5wZW5jaWxZLCBjb29yZGluYXRlcy54LCBjb29yZGluYXRlcy55KTtcbiAgICAgIHRoaXMuc2F2ZUNhbnZhc1N0YXRlKCk7XG4gICAgfSBlbHNlIGlmIChlLnR5cGUgPT09IHRoaXMuZXZlbnRzVHlwZXMubW91c2V1cCkge1xuICAgICAgdGhpcy5pc1BlbmNpbERyYXdTdGFydCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG5cbiAgZHJhd0xpbmUoeDAsIHkwLCB4MSwgeTEpIHtcbiAgICBpZiAoTWF0aC5hYnMoeTEgLSB5MCkgPCBNYXRoLmFicyh4MSAtIHgwKSkge1xuICAgICAgaWYgKHgwID4geDEpIHtcbiAgICAgICAgdGhpcy5kcmF3TGluZUxvdyh4MSwgeTEsIHgwLCB5MCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRyYXdMaW5lTG93KHgwLCB5MCwgeDEsIHkxKTtcbiAgICAgIH1cbiAgICB9IGVsc2VcbiAgICBpZiAoeTAgPiB5MSkge1xuICAgICAgdGhpcy5kcmF3TGluZUhpZ2goeDEsIHkxLCB4MCwgeTApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRyYXdMaW5lSGlnaCh4MCwgeTAsIHgxLCB5MSk7XG4gICAgfVxuXG4gICAgdGhpcy5wZW5jaWxYID0geDE7XG4gICAgdGhpcy5wZW5jaWxZID0geTE7XG4gIH1cblxuICBkcmF3TGluZUxvdyh4MCwgeTAsIHgxLCB5MSkge1xuICAgIGNvbnN0IGRlbHRhWCA9IHgxIC0geDA7XG4gICAgbGV0IGRlbHRhWSA9IHkxIC0geTA7XG4gICAgbGV0IGRpciA9IDE7XG4gICAgaWYgKGRlbHRhWSA8IDApIHtcbiAgICAgIGRpciA9IC0xO1xuICAgICAgZGVsdGFZID0gLWRlbHRhWTtcbiAgICB9XG5cbiAgICBsZXQgZGlmZiA9IDIgKiBkZWx0YVkgLSBkZWx0YVg7XG4gICAgbGV0IHkgPSB5MDtcblxuICAgIGZvciAobGV0IHggPSB4MDsgeCA8PSB4MTsgeCArPSAxKSB7XG4gICAgICB0aGlzLmRyYXdQaXhlbCh7IHgsIHkgfSk7XG4gICAgICBpZiAoZGlmZiA+IDApIHtcbiAgICAgICAgeSArPSBkaXI7XG4gICAgICAgIGRpZmYgLT0gMiAqIGRlbHRhWDtcbiAgICAgIH1cblxuICAgICAgZGlmZiArPSAyICogZGVsdGFZO1xuICAgIH1cbiAgfVxuXG4gIGRyYXdMaW5lSGlnaCh4MCwgeTAsIHgxLCB5MSkge1xuICAgIGxldCBkZWx0YVggPSB4MSAtIHgwO1xuICAgIGNvbnN0IGRlbHRhWSA9IHkxIC0geTA7XG5cbiAgICBsZXQgZGlyID0gMTtcbiAgICBpZiAoZGVsdGFYIDwgMCkge1xuICAgICAgZGlyID0gLTE7XG4gICAgICBkZWx0YVggPSAtZGVsdGFYO1xuICAgIH1cblxuICAgIGxldCBkaWZmID0gMiAqIGRlbHRhWCAtIGRlbHRhWTtcbiAgICBsZXQgeCA9IHgwO1xuXG4gICAgZm9yIChsZXQgeSA9IHkwOyB5IDw9IHkxOyB5ICs9IDEpIHtcbiAgICAgIHRoaXMuZHJhd1BpeGVsKHsgeCwgeSB9KTtcbiAgICAgIGlmIChkaWZmID4gMCkge1xuICAgICAgICB4ICs9IGRpcjtcbiAgICAgICAgZGlmZiAtPSAyICogZGVsdGFZO1xuICAgICAgfVxuXG4gICAgICBkaWZmICs9IDIgKiBkZWx0YVg7XG4gICAgfVxuICB9XG5cbiAgZHJhd1BpeGVsKGNvb3JkaW5hdGVzKSB7XG4gICAgdGhpcy5jdHguZmlsbFN0eWxlID0gdGhpcy5jdXJyZW50Q29sb3I7XG4gICAgdGhpcy5jdHguZmlsbFJlY3QoXG4gICAgICBjb29yZGluYXRlcy54ICogdGhpcy5waXhlbFNpemUsXG4gICAgICBjb29yZGluYXRlcy55ICogdGhpcy5waXhlbFNpemUsXG4gICAgICB0aGlzLnBpeGVsU2l6ZSxcbiAgICAgIHRoaXMucGl4ZWxTaXplLFxuICAgICk7XG4gIH1cblxuICBnZXRQb2ludGVyUG9zaXRpb24oY2xpZW50WCwgY2xpZW50WSkge1xuICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCB4ID0gTWF0aC5mbG9vcigoY2xpZW50WCAtIHJlY3QubGVmdCkgLyB0aGlzLnBpeGVsU2l6ZSk7XG4gICAgY29uc3QgeSA9IE1hdGguZmxvb3IoKGNsaWVudFkgLSByZWN0LnRvcCkgLyB0aGlzLnBpeGVsU2l6ZSk7XG5cbiAgICByZXR1cm4geyB4LCB5IH07XG4gIH1cblxuICBnZXRQb2ludGVkQ29sb3IoY2xpZW50WCwgY2xpZW50WSkge1xuICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCB4ID0gY2xpZW50WCAtIHJlY3QubGVmdDtcbiAgICBjb25zdCB5ID0gY2xpZW50WSAtIHJlY3QudG9wO1xuICAgIGxldCBjb2xvciA9IHRoaXMuY3R4LmdldEltYWdlRGF0YSh4LCB5LCAxLCAxKS5kYXRhO1xuICAgIGNvbG9yID0gSGVscGVycy5nZXRDb2xvcihjb2xvcik7XG5cbiAgICByZXR1cm4gY29sb3I7XG4gIH1cblxuICBjaGFuZ2VDdXJyZW50Q29sb3IoZSkge1xuICAgIGNvbnN0IGZpZWxkID0gZS50YXJnZXQ7XG4gICAgY29uc3QgY29sb3IgPSBmaWVsZC52YWx1ZTtcbiAgICB0aGlzLnNldFByZXZDb2xvcih0aGlzLmN1cnJlbnRDb2xvcik7XG4gICAgdGhpcy5jdXJyZW50Q29sb3IgPSBjb2xvcjtcbiAgICB0aGlzLnNldEN1cnJlbnRJY29uQ29sb3IoZmllbGQsIGNvbG9yKTtcbiAgfVxuXG4gIHNldEN1cnJlbnRJY29uQ29sb3IoZmllbGQsIGNvbG9yKSB7XG4gICAgY29uc3QgaWNvbiA9IGZpZWxkLmNsb3Nlc3QoJy50b29sc19ncm91cF9faXRlbScpLnF1ZXJ5U2VsZWN0b3IoJy5pY29uX2NvbG9yJyk7XG4gICAgaWNvbi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjtcbiAgfVxuXG4gIHNldFByZXZDb2xvcihjb2xvcikge1xuICAgIHRoaXMucHJldkNvbG9yID0gY29sb3I7XG4gICAgdGhpcy5wcmV2Q29sb3JJY29uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuICB9XG5cbiAgc2V0Q3VycmVudENvbG9yKGVsZW0pIHtcbiAgICBjb25zdCBpY29uID0gZWxlbS5xdWVyeVNlbGVjdG9yKCcuaWNvbl9jb2xvcicpO1xuICAgIGNvbnN0IGNvbG9yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoaWNvbikuYmFja2dyb3VuZENvbG9yO1xuICAgIHRoaXMuY3VycmVudENvbG9yID0gY29sb3I7XG4gICAgdGhpcy5jdXJyZW5Db2xvckZpZWxkLnZhbHVlID0gY29sb3I7XG4gICAgdGhpcy5jdXJyZW50Q29sb3JJY29uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuICB9XG5cbiAgZHJhd0ltYWdlKGltYWdlKSB7XG4gICAgdGhpcy5jdHguZHJhd0ltYWdlKGltYWdlLCAwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gIH1cblxuICBjaGFuZ2VDYW52YXNTaXplKGVsZW0pIHtcbiAgICBjb25zdCBlbGVtQ2xhc3NlcyA9IGVsZW0uY2xhc3NMaXN0O1xuXG4gICAgaWYgKGVsZW1DbGFzc2VzLmNvbnRhaW5zKCdhY3RpdmUnKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGFjdGl2ZUVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FudmFzX2NoYW5nZS5hY3RpdmUnKTtcbiAgICBhY3RpdmVFbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgIGVsZW1DbGFzc2VzLmFkZCgnYWN0aXZlJyk7XG5cbiAgICB0aGlzLnBpeGVscyA9IGVsZW0uZGF0YXNldC5waXhlbHM7XG4gICAgdGhpcy5jbGVhckNhbnZhcygpO1xuICB9XG5cbiAgc2F2ZUNhbnZhc1N0YXRlKCkge1xuICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgIGltYWdlU3JjOiB0aGlzLmNhbnZhcy50b0RhdGFVUkwoKSxcbiAgICAgIHBpeGVsczogdGhpcy5waXhlbHMsXG4gICAgfTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLmNhbnZhc0lkLCBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgfVxuXG4gIGdldENhbnZhc1N0YXRlKCkge1xuICAgIGNvbnN0IHBhcmFtc1N0ciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMuY2FudmFzSWQpO1xuXG4gICAgaWYgKHBhcmFtc1N0cikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zU3RyKTtcbiAgICAgICAgdGhpcy5waXhlbHMgPSBwYXJhbXMucGl4ZWxzO1xuICAgICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAuY2FudmFzX2NoYW5nZWApLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHBpeGVsc0RhdGEgPSBlbGVtLmRhdGFzZXQucGl4ZWxzO1xuXG4gICAgICAgICAgICBpZiAocGl4ZWxzRGF0YSA9PT0gdGhpcy5waXhlbHMpIHtcbiAgICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIGltYWdlLnNyYyA9IHBhcmFtcy5pbWFnZVNyYztcblxuICAgICAgICBpbWFnZS5vbmxvYWQgPSB0aGlzLmRyYXdJbWFnZS5iaW5kKHRoaXMsIGltYWdlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgYWxlcnQoJ0xvYWRpbmcgc2F2aW5nIHN0YXRlIHdhcyBmYWlsZWQuIEFuIGVtcHR5IGNhbnZhcyB3aWxsIGNyZWF0ZS4nKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpbml0KCkge1xuICAgIHRoaXMuZ2V0Q2FudmFzU3RhdGUoKTtcbiAgICB0aGlzLnNldEV2ZW50cygpO1xuICB9XG59XG4iLCJpbXBvcnQgJy4uL3N0eWxlcy9zdHlsZS5jc3MnO1xuXG4vLyBpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5pbXBvcnQgQ2FudmFzIGZyb20gJy4vY2FudmFzJztcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgY29uc3QgcGFsZXR0ZSA9IG5ldyBDYW52YXMoJ3BhbGV0dGUnKTtcbiAgcGFsZXR0ZS5pbml0KCk7XG59XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBpbml0KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=